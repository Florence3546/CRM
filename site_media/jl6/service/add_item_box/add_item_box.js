define("jl6/site_media/service/add_item_box/add_item_box",["jl6/site_media/widget/alert/alert","jl6/site_media/widget/ajax/ajax","jl6/site_media/widget/lightMsg/lightMsg","jl6/site_media/widget/loading/loading","jl6/site_media/plugins/artTemplate/template"],function(alert,ajax,lightMsg,loading,template){var loadAdgParams,loadItemParams,mnt_type=0,adg_counts=0,cur_counts=0,strategy={},load='<tr class="load_adg"><td colspan="6"><div class="text-center"><img src="/site_media/jl6/static/images/ajax_loader.gif" alt=""><br><span>请稍候...</span></div></td></tr>',no_more='<tr class="load_adg"><td colspan="6"><div class="text-center"><span>暂无更多数据</span></div></td></tr>',setStrategy=function(t){strategy=t},init=function(t){mnt_type=t.mnt_type?t.mnt_type:0,adg_counts=t.adg_counts?t.adg_counts:0,cur_counts=t.cur_count?t.cur_count:0,0!=mnt_type&&$(".doable_count").html(adg_counts),$(".doing_count").html(cur_counts),0==mnt_type&&$(".show_doable_count").addClass("hide"),$(".last_page").click(function(){var t=$(this).parent().find(".current_page").text();return"1"==t?("1"==$(this).attr("load_type")?$("#cur_campaign_adg_table tbody").html(no_more):$("#other_adg_table tbody").html(no_more),!1):void("1"==$(this).attr("load_type")?(loadAdgParams.page_no=parseInt(t)-1,loadAdgList(loadAdgParams)):(loadItemParams.page_no=parseInt(t)-1,loadItemList(loadItemParams)))}),$(".next_page").click(function(){var t=$(this).parent().find(".current_page").text(),e=$(this).parent().find(".next_page").attr("page_no");return t==e?("1"==$(this).attr("load_type")?$("#cur_campaign_adg_table tbody").html(no_more):$("#other_adg_table tbody").html(no_more),!1):void("1"==$(this).attr("load_type")?(loadAdgParams.page_no=parseInt(t)+1,loadAdgList(loadAdgParams)):(loadItemParams.page_no=parseInt(t)+1,loadItemList(loadItemParams)))}),$("#hide_adgs").on("change",function(){$(".has_campaign").parents("tr").toggleClass("hide")}),$("#cur_campaign_adg_table").on("click",".add_adgroup",function(){var t=$(this).closest("tr");0!=mnt_type&&(t=check_adg_count(t)),t.length>0&&add_adgroup(t,"1")}),$("#other_adg_table").on("click",".add_item",function(){var t=$(this).closest("tr");0!=mnt_type&&(t=check_adg_count(t)),t.length>0&&add_item(t,"0")}),$(".panel-group").on("click",".batch_add",function(){if(Number($(".doable_count").html())>0){var t=$(this).closest(".panel"),e=t.find("tbody tr:not(.hide)");0!=mnt_type&&(e=check_adg_count(e));var a=e.length;switch(t.attr("adg_type")){case"other":e.length>0&&add_item(e,"0");break;case"current":e.length>0&&add_adgroup(e,"1")}a==e.length&&$(this).siblings().find(".next_page").click()}else alert.show("可托管宝贝数已达上限！")}),$(".undo_all").on("click",function(){$.map($("#item_cart").find("tr"),function(t){var e=$(t).attr("item_id"),a=$(t).attr("tb"),i=$('#recycle_bin tr[item_id="'+e+'"]');"0"==a?$("#other_adg_table").prepend(i):"1"==a&&$("#cur_campaign_adg_table").prepend(i),t.remove()}),update_statistic_data()}),$("#item_cart").on("click",".undo",function(){var t=$(this).closest("tr").attr("item_id"),e=$(this).closest("tr").attr("tb"),a=$('#recycle_bin tr[item_id="'+t+'"]');"0"==e?$("#other_adg_table").prepend(a):"1"==e&&$("#cur_campaign_adg_table").prepend(a),$(this).closest("tr").remove(),update_statistic_data()}),$("#search_btn_left").click(function(){var t=$.trim($("#search_val_left").val());loadItemParams.sSearch=t,loadItemParams.page_no=1,loadItemList(loadItemParams),loadAdgParams&&(loadAdgParams.sSearch=t,loadAdgParams.page_no=1,loadAdgList(loadAdgParams))}),$("#search_val_left").keyup(function(t){if(13==t.keyCode){var e=$.trim($("#search_val_left").val());loadItemParams.sSearch=e,loadItemParams.page_no=1,loadItemList(loadItemParams),loadAdgParams&&(loadAdgParams.sSearch=e,loadAdgParams.page_no=1,loadAdgList(loadAdgParams))}}),$("#collapseOne").on("hidden.bs.collapse",function(){$("#collapseTwo").collapse("show")}),$("#search_cart").click(function(){var t=$.trim($("#search_cart_val").val()),e=$("#item_cart tr");$.map(e,function(e){var a=$(e).find('[name="item_title"]').text();a.indexOf(t)>-1?$(e).show():$(e).hide()})}),$("#search_cart_val").keyup(function(t){if(13==t.keyCode){var e=$.trim($("#search_cart_val").val()),a=$("#item_cart tr");$.map(a,function(t){var a=$(t).find('[name="item_title"]').text();a.indexOf(e)>-1?$(t).show():$(t).hide()})}}),$("#item_cart").on("click",".edit_pen_image",function(){var t=$(this).parents("tr"),e=$(this).find("[name=creative_img]"),a=e.closest("tr").attr("item_id"),i=e.attr("src"),r=e.parent().index(),n=$.map(e.closest("tr").find('[name="item_imgs"] li'),function(t){return $(t).html()});n.length>0?require(["jl6/site_media/service/add_item_box/select_item_img"],function(t){t.show({item_id:a,no:r,img_no:r+1,item_imgs:n,cur_img:i,onChange:function(t){$('#item_cart tr[item_id="'+a+'"] [name="creative_img"]:eq('+r+")").replaceWith('<img name="creative_img" src="'+t+'" width="60" height="60" title="点击换图" />')}})}):(loading.show("正在加载创意图片，请稍候..."),ajax.ajax("get_item_imgs",{item_id_list:JSON.stringify([a]),context:JSON.stringify({all_item_list:[a]})},function(e){loading.hide();var n=e.item_dict,d=n[a];require(["jl6/site_media/service/add_item_box/select_item_img"],function(t){t.show({item_id:a,no:r,img_no:r+1,item_imgs:d,cur_img:i,onChange:function(t){$('#item_cart tr[item_id="'+a+'"] [name="creative_img"]:eq('+r+")").replaceWith('<img name="creative_img" src="'+t+'" width="60" height="60" title="点击换图" />')}})});for(var l=t.find('[name="item_imgs"]'),_=0;_<d.length;_++)l.append("<li>"+d[_]+"</li>")}))}),$("#item_cart").on("click",".set_adg_cfg",function(){loading.show("数据加载中，请稍候...");var t=$(this).parents("tr"),e=$(t).attr("cat_id");ajax.ajax("get_cat_avg_cpc",{cat_id_list:[e]},function(e){loading.hide();var a=e.avg_cpc,i={mnt_opt_type:$(t).find(".mnt_opt_type").attr("value"),camp_limit:$(t).find(".adg_cfg").attr("camp_limit"),default_price_pc:strategy.max_price_pc,default_price_yd:strategy.max_price_yd,customer_price_pc:$(t).find(".limit_price_pc").attr("value"),customer_price_yd:$(t).find(".limit_price_yd").attr("value"),onChange:function(e){"1"==e.use_camp_limit?($(t).find(".limit_price_pc").attr("value",parseFloat(strategy.max_price_pc).toFixed(2)),$(t).find(".limit_price_pc").text(parseFloat(strategy.max_price_pc).toFixed(2)),$(t).find(".limit_price_yd").attr("value",parseFloat(strategy.max_price_yd).toFixed(2)),$(t).find(".limit_price_yd").text(parseFloat(strategy.max_price_yd).toFixed(2))):($(t).find(".limit_price_pc").attr("value",parseFloat(e.customer_price_pc).toFixed(2)),$(t).find(".limit_price_pc").text(parseFloat(e.customer_price_pc).toFixed(2)),$(t).find(".limit_price_yd").attr("value",parseFloat(e.customer_price_yd).toFixed(2)),$(t).find(".limit_price_yd").text(parseFloat(e.customer_price_yd).toFixed(2))),$(t).find(".adg_cfg").attr("camp_limit",e.use_camp_limit),$(t).find(".mnt_opt_type").attr("value",e.mnt_opt_type),$(t).find(".mnt_opt_type").text(2==e.mnt_opt_type?"只改价":"自动优化")}};i.avg_price=a.toFixed(2),i.min_price=Math.max((.3*a).toFixed(2),.05),i.suggest_price=1==mnt_type||3==mnt_type?(1.5*a).toFixed(2)+"~"+(2.5*a).toFixed(2):(2*a).toFixed(2)+"~"+(3*a).toFixed(2),i.opt_adgroup=!1,require(["jl6/site_media/service/add_item_box/set_adg_cfg"],function(t){t.show(i)})},null,{url:"/mnt/ajax/"})}),$("#item_cart").on("keyup",'input[name="adg_title"]',function(){check_adg_title_length($(this).val(),$(this).parent())}),$("#hide_no_pic").on("change",function(){$(this).prop("checked")?$("tr[has_pic=0]").addClass("hide"):$("tr[has_pic=0]").removeClass("hide")}),$("#collapseOne,#collapseTwo").on("show.bs.collapse",function(){$(this).prev().find(".collapse-icon").toggleClass("hide")}),$("#collapseOne,#collapseTwo").on("hide.bs.collapse",function(){$(this).prev().find(".collapse-icon").toggleClass("hide")})},loadAdgList=function(t){$("#cur_campaign_adg_table tbody").html(load),ajax.ajax("get_adg_list",t,loadAdgListBack,null,{url:"/mnt/ajax/"}),loadAdgParams=t},loadAdgListBack=function(t){for(var e,a='{{each adg_list as value index}}\r\n <tr {{ if !value.has_pic }} class="hide" {{ /if }} adgroup_id="{{ value.adgroup_id }}" has_pic="{{ if value.has_pic }}1{{ else }}0{{ /if }}" item_id="{{ value.item_id }}" id="{{ value.item_id }}"  cat_id="{{ value.cat_id }}">\r\n    <td class="hide">{{ index }}</td>\r\n    <td style="padding: 2px; width: 74px; height: 74px;">\r\n        <div class="add_adg_img">\r\n            <a href="javascript:void(0);">\r\n                {{ if value.has_pic }}\r\n                <img src="{{value.pic_url}}_70x70.jpg" class="pic_url">\r\n                {{ else }}\r\n                <img src="/site_media/jl6/static/images/no_photo_70x70.jpg?t=1490089588990" class="pic_url">\r\n                {{ /if }}\r\n            </a>\r\n            <div class="hover {{ if list_type==\'other\' }}add_item{{ else }}add_adgroup{{ /if }}"><a><i class="iconfont">&#xe62d;</i></a></div>\r\n        </div>\r\n    </td>\r\n    <td class="tl vm" style="width: 270px; overflow: hidden">\r\n        <div>\r\n            <a  name="item_title" class="to_item_page" target="_blank" href=\'http://item.taobao.com/item.htm?id={{ value.item_id }}\'>{{ value.title }}&emsp;</a>\r\n            <span>￥{{value.price}}</span>\r\n        </div>\r\n    </td>\r\n     {{ if list_type==\'other\' }}\r\n     <td class="tc vm" style="width: 85px; overflow: hidden">\r\n        {{value.sales_count}}\r\n    </td>\r\n     <td class="tc vm" style="width: 85px; overflow: hidden">\r\n      {{value.stock}}\r\n    </td>\r\n    <td class="tc vm {{if value.camp_id_list.length>0}}has_campaign{{ /if }}"  style="width: 100px; overflow: hidden" camp_id_list=\'{{ value.camp_id_list.length }}\'>\r\n\r\n      {{if value.camp_id_list.length>0}}\r\n        <div class="adg_camp">\r\n            <span class="poi" data-toggle="tooltip" data-placement="left"\r\n                title="{{ each value.camp_id_list as camp camp_index }}{{ camp }}<br/>{{ /each }}">\r\n                <strong>{{ value.camp_id_list.length }}个计划下推广</strong>\r\n            </span>\r\n        </div>\r\n      {{ else }}\r\n        未推广\r\n      {{ /if }}\r\n    </td>\r\n     <td class="tc pr5">\r\n        <a href="javascript:;" class="add_item b f16" value="{{ value.item_id }}"><i class="iconfont">&#xe65c;</i></a>\r\n    </td>\r\n     {{ else }}\r\n     <td class="tc vm"  style="width: 85px; overflow: hidden">\r\n      {{value.click}}\r\n    </td>\r\n     <td class="tc vm" style="width: 85px; overflow: hidden">\r\n      {{value.paycount}}\r\n    </td>\r\n     <td class="tc vm" style="width: 100px; overflow: hidden">\r\n        {{value.roi}}\r\n    </td>\r\n     <td class="tc pr5">\r\n        <a href="javascript:;" class="add_adgroup b f16" value="{{ value.item_id }}"><i class="iconfont">&#xe65c;</i></a>\r\n    </td>\r\n     {{ /if }}\r\n</tr>\r\n{{/each}}',i=t.data,r=[],n=!0,d=0;d<i.length;d++)$('#item_cart tbody tr[item_id="'+i[d].item_id+'"]').length||r.push(i[d]),i[d].has_pic||(n=!1);n||$(".hide_no_pic").removeClass("hide"),e=template.compile(a)({adg_list:r,list_type:0}),t.page_count>1&&($("#more_adgs").removeClass("hide"),$("#more_adgs").find(".current_page").text(t.current_page),$("#more_adgs").find(".page_count").text(t.page_count),$("#more_adgs").find(".last_page").attr("page_no",parseInt(t.current_page)-1),t.has_more?$("#more_adgs").find(".next_page").attr("page_no",parseInt(t.current_page)+1):$("#more_adgs").find(".next_page").attr("page_no",parseInt(t.current_page))),$("#cur_campaign_adg_table tbody").html(e)},loadItemList=function(t){$("#other_adg_table tbody").html(load),ajax.ajax("get_item_list",t,loadItemListBack,null,{url:"/mnt/ajax/"}),loadItemParams=t},loadItemListBack=function(t){for(var e,a='{{each adg_list as value index}}\r\n <tr {{ if !value.has_pic }} class="hide" {{ /if }} adgroup_id="{{ value.adgroup_id }}" has_pic="{{ if value.has_pic }}1{{ else }}0{{ /if }}" item_id="{{ value.item_id }}" id="{{ value.item_id }}"  cat_id="{{ value.cat_id }}">\r\n    <td class="hide">{{ index }}</td>\r\n    <td style="padding: 2px; width: 74px; height: 74px;">\r\n        <div class="add_adg_img">\r\n            <a href="javascript:void(0);">\r\n                {{ if value.has_pic }}\r\n                <img src="{{value.pic_url}}_70x70.jpg" class="pic_url">\r\n                {{ else }}\r\n                <img src="/site_media/jl6/static/images/no_photo_70x70.jpg?t=1490089588990" class="pic_url">\r\n                {{ /if }}\r\n            </a>\r\n            <div class="hover {{ if list_type==\'other\' }}add_item{{ else }}add_adgroup{{ /if }}"><a><i class="iconfont">&#xe62d;</i></a></div>\r\n        </div>\r\n    </td>\r\n    <td class="tl vm" style="width: 270px; overflow: hidden">\r\n        <div>\r\n            <a  name="item_title" class="to_item_page" target="_blank" href=\'http://item.taobao.com/item.htm?id={{ value.item_id }}\'>{{ value.title }}&emsp;</a>\r\n            <span>￥{{value.price}}</span>\r\n        </div>\r\n    </td>\r\n     {{ if list_type==\'other\' }}\r\n     <td class="tc vm" style="width: 85px; overflow: hidden">\r\n        {{value.sales_count}}\r\n    </td>\r\n     <td class="tc vm" style="width: 85px; overflow: hidden">\r\n      {{value.stock}}\r\n    </td>\r\n    <td class="tc vm {{if value.camp_id_list.length>0}}has_campaign{{ /if }}"  style="width: 100px; overflow: hidden" camp_id_list=\'{{ value.camp_id_list.length }}\'>\r\n\r\n      {{if value.camp_id_list.length>0}}\r\n        <div class="adg_camp">\r\n            <span class="poi" data-toggle="tooltip" data-placement="left"\r\n                title="{{ each value.camp_id_list as camp camp_index }}{{ camp }}<br/>{{ /each }}">\r\n                <strong>{{ value.camp_id_list.length }}个计划下推广</strong>\r\n            </span>\r\n        </div>\r\n      {{ else }}\r\n        未推广\r\n      {{ /if }}\r\n    </td>\r\n     <td class="tc pr5">\r\n        <a href="javascript:;" class="add_item b f16" value="{{ value.item_id }}"><i class="iconfont">&#xe65c;</i></a>\r\n    </td>\r\n     {{ else }}\r\n     <td class="tc vm"  style="width: 85px; overflow: hidden">\r\n      {{value.click}}\r\n    </td>\r\n     <td class="tc vm" style="width: 85px; overflow: hidden">\r\n      {{value.paycount}}\r\n    </td>\r\n     <td class="tc vm" style="width: 100px; overflow: hidden">\r\n        {{value.roi}}\r\n    </td>\r\n     <td class="tc pr5">\r\n        <a href="javascript:;" class="add_adgroup b f16" value="{{ value.item_id }}"><i class="iconfont">&#xe65c;</i></a>\r\n    </td>\r\n     {{ /if }}\r\n</tr>\r\n{{/each}}',i=t.data,r=[],n=!0,d=0;d<i.length;d++)$('#item_cart tbody tr[item_id="'+i[d].item_id+'"]').length||r.push(i[d]),i[d].has_pic||(n=!1);n||$(".hide_no_pic").removeClass("hide"),e=template.compile(a)({adg_list:r,list_type:"other"}),$("#more_other_items").find(".current_page").text(t.current_page),t.has_more?($("#more_other_items").removeClass("hide"),$("#more_other_items").find(".last_page").attr("page_no",parseInt(t.current_page)-1),$("#more_other_items").find(".next_page").attr("page_no",parseInt(t.current_page)+1)):(1==t.current_page&&$("#more_other_items").addClass("hide"),$("#more_other_items").find(".next_page").attr("page_no",parseInt(t.current_page))),$("#other_adg_table tbody").html(e),$("#hide_adgs").removeAttr("checked"),$(".adg_camp span").tooltip({html:!0})},add_item=function(t,e){add_to_cart(t,e)},add_adgroup=function(t,e){add_to_cart(t,e)},add_to_cart=function(t,e){for(var a=[],i=[],r={},n=0;n<t.length;n++){var d=t[n];if(!$(d).hasClass("load_adg")){var l=$(d).attr("item_id");a.push($(d).attr("item_id")),i.push(Number($(d).attr("item_id")));var _=($.map($(d).find('[name="item_imgs"] li'),function(t){return $(t).html()}),{adgroup_id:$(d).attr("adgroup_id"),item_id:$(d).attr("item_id"),title:$(d).find('[name="item_title"]').html(),pic_url:$(d).find(".pic_url").attr("src"),cat_id:$(d).attr("cat_id")});r[l]=_}}update_mnt_adgroup_table(r,e,t)},update_mnt_adgroup_table=function(t,e,a){var i,r='{{ each data }}\r\n<tr item_id="{{ $value.item_id }}" adgroup_id="{{ $value.adgroup_id }}" cat_id="{{ $value.cat_id }}" class="bbd hover" tb="{{ tb }}">\r\n    <td class="tc vm w50 undo poi"><a class="b f16" href="javascript:;"><i class="iconfont">&#xe62a;</i></a>\r\n        <ul class="hide" name="item_imgs">\r\n        </ul>\r\n    </td>\r\n    <td class="w60 bld" style="padding: 2px;">\r\n        <div class="adg_img edit_pen_image">\r\n            <img name="creative_img" width="60" height="60" src="{{ $value.pic_url }}"/>\r\n            <div class="hover"><a><i class="iconfont">&#xe609;</i></a></div>\r\n        </div>\r\n        <div class="adg_img mt2 edit_pen_image">\r\n            <img name="creative_img" width="60" height="60" src="{{ $value.pic_url }}"/>\r\n            <div class="hover"><a><i class="iconfont">&#xe609;</i></a></div>\r\n        </div>\r\n    </td>\r\n    <td class="tl">\r\n        <div class="mt5">\r\n            <a  name="item_title" class="to_item_page" target="_blank" href=\'http://item.taobao.com/item.htm?id={{ $value.item_id }}\'>{{ $value.title }}&emsp;</a>\r\n        </div>\r\n        {{ if mnt_type!=\'0\'}}\r\n        <div class="mt3 adg_cfg" camp_limit="1">\r\n            PC限价：<span class="limit_price_pc" value="{{ strategy.max_price_pc }}">{{ strategy.max_price_pc }}</span>元&nbsp;&nbsp;&nbsp;\r\n            移动限价：<span class="limit_price_yd" value="{{ strategy.max_price_yd }}">{{ strategy.max_price_yd }}</span>元&nbsp;&nbsp;&nbsp;\r\n            优化方式：<span class="mnt_opt_type" value="{{ strategy.mnt_opt_type }}">{{ if strategy.mnt_opt_type==1 }}自动优化{{ else }}只改价{{ /if }}</span>&nbsp;&nbsp;&nbsp;\r\n            <a href="javascript:;" class="f14 set_adg_cfg"><strong><i class="iconfont">&#xe639;</i></strong></a>\r\n        </div>\r\n        {{ else }}\r\n        <br/>\r\n        {{ /if }}\r\n\r\n        <div class="adg_title mt5"><span>{{ if tb==\'0\' }}新增创意1：{{ else }}创意标题1：{{ /if }}</span>\r\n            <input name="adg_title" type="text" class="w320" value="正在获取..."/>&nbsp;\r\n            <span name="char_delta">剩20个汉字</span>\r\n        </div>\r\n        <div class="adg_title mt5"><span>{{ if tb==\'0\' }}新增创意2：{{ else }}创意标题2：{{ /if }}</span>\r\n            <input name="adg_title" type="text" class="w320" value="正在获取..."/>&nbsp;\r\n            <span name="char_delta">剩20个汉字</span>\r\n        </div>\r\n        <div class="error_list lh30 red b hide">\r\n        </div>\r\n    </td>\r\n</tr>\r\n{{ /each }}';i=template.compile(r)({data:t,mnt_type:mnt_type,tb:e,strategy:strategy}),$("#item_cart tbody").prepend(i),a.removeClass("hover"),$("#recycle_bin").append(a.clone()),a.remove(),update_statistic_data(),getorcreate_adg_title_list(t)},getorcreate_adg_title_list=function(datas){for(var i in datas)ajax.ajax("getorcreate_adg_title_list",{item_id:datas[i].item_id,adgroup_id:datas[i].adgroup_id||0,title:datas[i].title},function(data){var type=data.type,item_id=data.item_id,adg_title_list=eval("("+data.adg_title_list+")"),tr_obj=$('#item_cart tr[item_id="'+item_id+'"]'),adg_title_obj=tr_obj.find(".adg_title");if(0==type){for(var i in adg_title_list)adg_title_obj.children('[name="adg_title"]:eq('+i+")").val(adg_title_list[i]).show(),check_adg_title_length(adg_title_list[i],adg_title_obj.eq(i));adg_title_obj.children('[name="length_prompt"]').removeClass("hide")}else if(1==type){var creative_obj=adg_title_list[0],new_adg_title=adg_title_list[1];if($.isPlainObject(creative_obj)&&!$.isEmptyObject(creative_obj)){var i=0;for(var creative_id in creative_obj){var creative_title=creative_obj[creative_id][0],creative_img=creative_obj[creative_id][1];adg_title_obj.eq(i).addClass("current").children('[name="adg_title"]').attr({creative_id:creative_id,org_value:creative_title,org_img:creative_img,no:i}).val(creative_title).show(),tr_obj.find('[name="creative_img"]:eq('+i+")").replaceWith('<img name="creative_img" src="'+creative_img+'_60x60.jpg" title="点击换图" />'),check_adg_title_length(creative_title,adg_title_obj.eq(i)),i++}1==i&&(adg_title_obj.eq(1).addClass("new").children('[name="adg_title"]').val(new_adg_title).show(),adg_title_obj.eq(1).children().first().html("新增创意2："),check_adg_title_length(new_adg_title,adg_title_obj.eq(1))),adg_title_obj.children('[name="length_prompt"]').show()}else adg_title_obj.hide(),tr_obj.find(".error_list").html('<i class="icon-warning-sign large marr_3"></i>获取创意失败，请先尝试同步直通车结构数据').show()}})},check_adg_title_length=function(t,e){var a=Math.floor(20-bytes_len($.trim(t))/2);return e.find('[name="char_delta"]').html(a>=0?"剩"+Math.abs(a)+"个汉字":'<span class="red">超'+Math.abs(a)+"个汉字</span>"),e.find('input[name="adg_title"]').attr("char_delta",a),a},get_seller_cids=function(){ajax.ajax("get_seller_cids",{},function(t){var e,a='<div class="select_warp ml0" id="search_opt_category">\r\n    <span class="tip form" data-toggle="dropdown" class="category_name">全部类目</span>\r\n    <ul class="dropdown-menu">\r\n        <li class="level w120" cat_id=""><a href="javascript:;" ><span class="category_title">全部类目</span></a></li>\r\n        {{ each cat_list }}\r\n        {{ if $value.child_cat_list.length>0 }}\r\n            <li class="dropdown-submenu level w120" cat_id="{{ $value.cat_id }}">\r\n                <a href="javascript:;"><span class="category_title">{{ $value.cat_name }}</span></a>\r\n                <!--<ul class="dropdown-menu">\r\n                <i class="iconfont f12">&#xe607;</i>\r\n                    {{ each $value.child_cat_list as child index }}\r\n                        <li class="level w120"  cat_id="{{ $value.cat_id }}"><a href="javascript:;"><span class="category_title">{{ child.cat_name }}</span></a></li>\r\n                    {{ /each }}\r\n                </ul>-->\r\n            </li>\r\n        {{ else }}\r\n        <li class="level w120" cat_id="{{ $value.cat_id }}"><a href="javascript:;"><span class="category_title">{{ $value.cat_name }}</span></a></li>\r\n        {{ /if }}\r\n        {{ /each }}\r\n    </ul>\r\n</div>';e=template.compile(a)({cat_list:t.cat_list}),$(".category").html(e)},null,{url:"/mnt/ajax/"})},bytes_len=function(t){for(var e=0,a=0;a<t.length;a++)e+=t.charCodeAt(a)>255?2:1;return e},handle_img_url=function(t){t=t.replace("_70x70.jpg","");var e=[".jpg",".png",".gif"];for(var a in e){var i=e[a];if(-1!=t.indexOf(i+"_"))return t=t.split(i+"_",1)[0]+i}return t},getMntAdgInfo=function(){var t={},e={},a=[];return $.map($('#item_cart tbody tr[tb="1"]'),function(i){var r=Number($(i).attr("adgroup_id"));if(r){var n={title1:$.trim($(i).find('[name="adg_title"]:eq(0)').val()),title2:$.trim($(i).find('[name="adg_title"]:eq(1)').val()),img_url1:handle_img_url($(i).find('[name="creative_img"]:eq(0)').attr("src")),img_url2:handle_img_url($(i).find('[name="creative_img"]:eq(1)').attr("src")),limit_price:100*Number(strategy.limit_price),mobile_limit_price:100*Number(strategy.limit_price),use_camp_limit:1,mnt_opt_type:1};n.limit_price=(100*Number($(i).find(".limit_price_pc").text())).toFixed(0),n.mobile_limit_price=(100*Number($(i).find(".limit_price_yd").text())).toFixed(0),n.use_camp_limit=$(i).find(".adg_cfg").attr("camp_limit"),n.mnt_opt_type=$(i).find(".mnt_opt_type").attr("value"),t[r]=n;for(var d=0;2>d;d++){var l=$(i).find('[name="adg_title"]:eq('+d+")"),_=handle_img_url($(i).find('[name="creative_img"]:eq('+d+")").attr("src"));if(l.parent().hasClass("current")){var s=handle_img_url($(i).find('[name="creative_img"]:eq('+d+")").attr("src")).split(".taobaocdn.com/",2)[1],c=l.attr("org_img").split(".taobaocdn.com/",2)[1];(l.val()!=l.attr("org_value")||s!=c)&&(e[Number(l.attr("creative_id"))]=[r,$.trim(l.val()),_])}else l.parent().hasClass("new")&&a.push([r,$.trim(l.val()),_])}}}),{mnt_adg_dict:t,update_creative_dict:e,new_creative_list:a}},getNewItemDict=function(){var t={};return $.map($('#item_cart tbody tr[tb="0"]'),function(e){var a=$(e).attr("item_id");if(a){var i={title1:$.trim($(e).find('[name="adg_title"]:eq(0)').val()),title2:$.trim($(e).find('[name="adg_title"]:eq(1)').val()),img_url1:handle_img_url($(e).find('[name="creative_img"]:eq(0)').attr("src")),img_url2:handle_img_url($(e).find('[name="creative_img"]:eq(1)').attr("src")),limit_price:100*Number(strategy.limit_price),mobile_limit_price:100*Number(strategy.limit_price),mnt_opt_type:1,use_camp_limit:1};i.limit_price=(100*Number($(e).find(".limit_price_pc").text())).toFixed(0),i.mobile_limit_price=(100*Number($(e).find(".limit_price_yd").text())).toFixed(0),i.use_camp_limit=$(e).find(".adg_cfg").attr("camp_limit"),i.mnt_opt_type=$(e).find(".mnt_opt_type").attr("value"),t[a]=i}}),t},update_statistic_data=function(){var t=$("#item_cart tbody tr").length;$(".doing_count").text($("#item_cart tbody tr").length),0!=mnt_type&&$(".doable_count").html(adg_counts-t)},check_adg_count=function(t){var e=$("#item_cart tbody tr").length;return t.length+e>adg_counts&&(alert.show("最多只能托管"+adg_counts+"个宝贝，多出的宝贝将不会添加。"),t=t.slice(0,adg_counts-e)),t},reDraw=function(t){mnt_type=t.mnt_type?t.mnt_type:0,adg_counts=t.adg_counts?t.adg_counts:500,cur_counts=t.cur_count?t.cur_count:0,0!=mnt_type&&$(".doable_count").html(adg_counts),$(".doing_count").html(cur_counts),$("#other_adg_table tbody").html(""),$("#other_adg_table tbody").html(""),$("#more_other_items tbody").html(""),$("#item_cart tbody").html("")},getSelectCounts=function(){return parseInt($(".doing_count").html())};return{init:init,loadAdgList:loadAdgList,loadItemList:loadItemList,getMntAdgInfo:getMntAdgInfo,getNewItemDict:getNewItemDict,setStrategy:setStrategy,getSelectCounts:getSelectCounts,reDraw:reDraw}});