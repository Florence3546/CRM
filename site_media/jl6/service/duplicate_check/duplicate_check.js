define("jl6/site_media/service/duplicate_check/duplicate_check",["jl6/site_media/service/common/common","jl6/site_media/plugins/data-tables/dataTableExt","jl6/site_media/widget/pageBar/pageBar","jl6/site_media/plugins/artTemplate/template","jl6/site_media/plugins/jquery.json-2.4.min"],function(e,t,l,a){var d,n,o,c,i=20,s=1,r=1,_="desc",u=-1,h=3,p=!0,b="level",f={del_level:3,del_day:7,del_statistics_type:"impressions",del_offline:0,del_longtail:0},m={del_qscore:3,del_day:7,del_statistics_type:"impressions",del_offline:0,del_longtail:0},k=function(){x(),$("#duplicate_table>tbody").on("click",".click_show",function(){var t=$(this).closest("tr"),l=t.find(".keyword").html();$(".cur_kw_title").html(l);var d=t.attr("index");if(u==d)return!1;if(u=d,$("#duplicate_table>tbody>tr").removeClass("cur_dupl_detail"),t.addClass("cur_dupl_detail"),t.data("has_load")){var n=t.data("detail");w(n)}else e.loading.show("数据加载中，请稍候..."),e.sendAjax.ajax("dupl_kw_detail",{keyword:l},function(l){var d,n;d='{{ each datas as value index }}\r\n<tr>\r\n    <td class="tc choose_sub_column"><input type="checkbox" class="child-select-sub" value="{{ value.kw_id }}"/></td>\r\n    <td class="tc"><span class="hide">{{ index + 1 }}</span><span class="adg_index"><i class="iconfont lock_kw f20">&#xe660;</i></span></td>\r\n    <td><span class="hide">{{ value.item_id }}</span><img alt="" width="40" height="40" src="{{ value.pic_url }}_40x40.jpg"/></td>\r\n    <td><span class="camp_id">{{ value.camp_id }}</span></td>\r\n    <td class="tc">{{ value.max_price }}</td>\r\n    <td class="tc">{{ value.max_mobile_price }}</td>\r\n    <td class="tc">{{ value.qscore }}</td>\r\n    <td class="tc">{{ value.wireless_qscore }}</td>\r\n    <td class="tc">{{ value.impr }}</td>\r\n    <td class="tc">{{ value.click }}</td>\r\n    <td class="tc">{{ value.cpc }}</td>\r\n    <td class="tc">{{ value.pay }}</td>\r\n</tr>\r\n{{ /each }}',n=a.compile(d)({datas:l.result}),t.data("detail",n),t.data("has_load",1),w(n),e.loading.hide()})}),$(document).on("change","table .choose_column :checkbox",function(){var e=$(this).prop("checked"),t=0;$(this).hasClass("select-all")?(e?$("#duplicate_table .choose_column :checkbox").prop("checked",!0):$("#duplicate_table .choose_column :checkbox").prop("checked",!1),t=$("#duplicate_table .child-select:checked").length):(t=$("#duplicate_table .child-select:checked").length,$("#duplicate_table .child-select").length==t?$(".choose_column .select-all").prop("checked",!0):$(".choose_column .select-all").prop("checked",!1)),$(".hand_del_count").html(t)}),$(document).on("change","table .choose_sub_column :checkbox",function(){var e=$("#dupl_detail_table"),t=$(this).prop("checked");if($(this).hasClass("select-all-sub"))t?e.find(".choose_sub_column :checkbox").not(":disabled").prop("checked",!0):e.find(".choose_sub_column :checkbox").prop("checked",!1);else{var l=e.find(".child-select-sub:checked").length;e.find(".child-select-sub").not(":disabled").length==l?$(".select-all-sub").prop("checked",!0):$(".select-all-sub").prop("checked",!1)}}),$("#dupl_detail_table").on("click",".lock_kw",function(){var e=$(this).closest("tr").find(".child-select-sub");e.prop("disabled")?($(this).html("&#xe660;"),e.prop("disabled",!1),e.prop("checked",!0)):($(this).html("&#xe620;"),e.prop("disabled",!0),e.prop("checked",!1)),e.trigger("change")}),$("#del_garbage").click(function(){return"0"==$(".garbage_count").html()?(e.alert.show("您的店铺暂无垃圾词，无需删除！"),!1):void e.confirm.show({body:"您确定要删除店铺中的垃圾词吗？",okHidden:function(){b="smart",e.loading.show("正在删除垃圾词，请稍候..."),e.sendAjax.ajax("delete_dupl_word",{del_type:"smart"},t)}})}),$("#del_by_score").click(function(){return"0"==$(".lowscore_count").html()?(e.alert.show("您的店铺暂无低分词，无需删除！"),!1):void e.confirm.show({body:"您确定按条件批量删除店铺中的低分词吗？",okHidden:function(){b="score",e.loading.show("正在删除低分词，请稍候..."),e.sendAjax.ajax("delete_dupl_word",{condition:$.toJSON(m),del_type:"advanced",word_list:[]},t)}})}),$("#del_by_condition").click(function(){return"0"==$(".duplicate_count").html()?(e.alert.show("您的店铺暂无重复词，无需删除！"),!1):void e.confirm.show({body:"您确定按条件批量删除店铺中的重复词吗？",okHidden:function(){b="level",e.loading.show("正在删除重复词，请稍候..."),e.sendAjax.ajax("delete_dupl_word",{condition:$.toJSON(f),del_type:"advanced",word_list:[]},t)}})}),$("#del_by_hand").click(function(){var l=y(),a=parseInt($(".hand_del_count").html());a>0?e.confirm.show({body:"<strong>说明：</strong>针对选中的关键词，删除重复次数大于3，过去7天展现量为0，且添加时间超过7天的重复词。您确定要删除吗？",okHidden:function(){b="level",e.loading.show("正在删除重复词，请稍候...");var a={del_level:3,del_day:7,del_offline:1,del_longtail:1,del_statistics_type:"impressions"};e.sendAjax.ajax("delete_dupl_word",{condition:$.toJSON(a),del_type:"advanced",word_list:l},t)}}):e.alert.show("请选中下方要删除的关键词！")});var t=function(t){if(e.loading.hide(),0===t.del_count)e.alert.show(t.failed_count>0?"亲，淘宝接口错误，删词失败，请稍后重试":"score"==b?"亲，您的店铺中不存在符合条件的低分词":"level"==b?"亲，您的店铺中不存在符合条件的重复词":"亲，您的店铺中不存在符合条件的垃圾词");else if(t.del_count>=0){var l="删除成功"+t.del_count+"个";t.failed_count>0&&(l+="，删除失败"+t.failed_count+"个"),e.alert.show({body:l,hidden:function(){s=1,x()}})}},l=!1;$(".to_carousel").click(function(){if(l)return!1;$(".to_carousel").removeClass("btn-primary"),$(this).addClass("btn-primary");var e=parseInt($(this).attr("item"));switch(e){case 3:p=!0;break;default:p=!1,$(".fixedHeader").hide()}$("#dupl_del_carousel").carousel(e)}),$("#dupl_del_carousel").on("slide.bs.carousel",function(){l=!0}),$("#dupl_del_carousel").on("slid.bs.carousel",function(){l=!1,p&&(n?n.fnUpdate():n=new FixedHeader(d),c?c.fnUpdate():c=new FixedHeader(o),$(".fixedHeader").show())}),$("#condition_detail").on("change",".select_warp",function(e,t){f[$(this).attr("name")]=t,$("#del_dupl_day").html(f.del_day)}),$("#condition_detail").on("change","#del_offline",function(){f.del_offline=$(this).prop("checked")?0:1}),$("#condition_detail").on("change","#del_longtail",function(){f.del_longtail=$(this).prop("checked")?0:1}),$("#condition_score").on("change",".select_warp",function(e,t){m[$(this).attr("name")]=t,$("#del_low_day").html(m.del_day)}),$("#condition_score").on("change","#del_offline_score",function(){m.del_offline=$(this).prop("checked")?0:1}),$("#condition_score").on("change","#del_longtail_score",function(){m.del_longtail=$(this).prop("checked")?0:1}),$("#id_recheck").click(function(){e.confirm.show({body:"排查重复词可能较慢，确认现在就重新排查吗？",okHidden:function(){s=1,x()}})}),$(document).on("click","#single_submit_btn",function(){var t=$("#duplicate_table").find("tr[index="+u+"]"),l=t.find(".dupl_times:first").html(),a=[];$("#dupl_detail_table tbody").find("input:checked").each(function(){a.push(parseInt($(this).val()))}),a.length?e.confirm.show({body:"确定要删除选中的重复词吗?",okHidden:function(){b="level",e.loading.show("正在删除重复词，请稍候..."),e.loading.hide(),e.sendAjax.ajax("delete_dupl_word",{kw_id_list:a,del_type:"manual"},function(a){e.loading.hide(),u=-1,t.data("has_load",!1),t.find(".click_show").click(),t.find(".dupl_times").html(parseInt(l)-a.del_count)})}}):e.alert.show("请选择下方未锁定的关键词！")}),$(".del_box").on("click",".select_div :radio,:checkbox",function(e){e.stopPropagation()}),$(".del_box").on("click",".select_div",function(){$(this).find(":radio,:checkbox").click()}),$('[data-toggle="tooltip"]').tooltip({html:!0})},g=function(e){u=-1,d&&(d.fnClearTable(),d.fnDestroy());var t,l;t='{{ each datas as value index }}\r\n<tr class="duplicate_keyword poi" index="{{ index }}">\r\n    <td class="tc choose_column"><input type="checkbox" class="child-select"/></td>\r\n    <td class="click_show">\r\n        <span class="hide dupl_times">{{ value.times }}</span>\r\n        <span class="keyword">{{ value.keyword }}</span>\r\n        <span class="r">\r\n            重复<span class="red b dupl_times">{{ value.times }}</span>次\r\n        </span>\r\n    </td>\r\n</tr>\r\n{{ /each }}',l=a.compile(t)({datas:e}),$("#duplicate_table tbody").html(l),d=$("#duplicate_table").dataTable({bRetrieve:!0,bPaginate:!1,bFilter:!1,bInfo:!1,bAutoWidth:!1,language:{emptyTable:"没有数据"},aoColumns:[{bSortable:!1},{bSortable:!1}],initComplete:function(){$.fn.dataTableExt.afnSortData["custom-text"]=function(e,t){return $.map(e.oApi._fnGetTrNodes(e),function(l,a){var d=e.oApi._fnGetTdNodes(e,a)[t],n=Number($(d).find("span:first").text());return r>1?0:n})}}}),n?n.fnUpdate():n=new FixedHeader(d),$(".select-all").prop("checked",!1),$(".click_show:first").click()},w=function(e){o&&(o.fnClearTable(),o.fnDestroy()),$("#dupl_detail_table tbody").html(e),o=$("#dupl_detail_table").dataTable({bRetrieve:!0,bPaginate:!1,bFilter:!1,bInfo:!1,bSort:!0,bAutoWidth:!1,language:{emptyTable:"没有数据"},aoColumns:[{bSortable:!1},{bSortable:!0},{bSortable:!0},{bSortable:!0},{bSortable:!0},{bSortable:!0},{bSortable:!0},{bSortable:!0},{bSortable:!0},{bSortable:!0},{bSortable:!0},{bSortable:!0}],fnRowCallback:function(e){var t=$(e).find("td:eq(1) span:first").text();parseInt(t)<=h&&($(e).find(".lock_kw").html("&#xe620;"),$(e).find(".child-select-sub").prop("disabled",!0))}}),c&&$(c.fnGetSettings().aoCache[0].nWrapper).remove(),c=new FixedHeader(o),$(".select-all-sub").prop("checked",!1)},v=function(e){s=parseInt(e),x()},x=function(){e.loading.show("数据加载中，请稍候..."),e.sendAjax.ajax("dupl_kw_list",{page_size:i,page_no:s,sort:_},function(t){r=Math.ceil(t.data_count/i);var a=t.data_count,d={inObj:$(".pagination_bar"),recordCount:a,page_size:i,page_no:s,onChange:v};$(".garbage_count").html(t.garbage_words_len),$(".duplicate_count").html(a),$(".lowscore_count").html(t.lowscore_words_len),$(".hand_del_count").html("0"),l.draw(d),g(t.duplicate_data_list),e.loading.hide()})},y=function(){var e=[];return $("#duplicate_table tbody input:checked").each(function(){e.push($(this).parent().next().find(".keyword").text())}),e};return{init:k}});