define("jl6/site_media/service/edit_camp_schedule/edit_camp_schedule",["jl6/site_media/plugins/artTemplate/template","jl6/site_media/plugins/jslider/js/jquery.slider","jl6/site_media/widget/alert/alert","jl6/site_media/service/edit_camp_schedule/schedule_templet"],function(t,i,l,a){"use strict";var e,s;e='<div class="modal fade">\n    <div class="modal-dialog" style="width:812px;" id="modal_camp_schedule">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n                <h4 class="modal-title">设置投放时间</h4>\n            </div>\n            <div class="modal-body">\n                <div class="alert alert-warning f12 mb10">\n                    <span>宝贝在不同时段流量和转化可能有所不同，您可以针对各时段设置不同的折扣出价，提高流量利用效果，</span>\n                    <a href="http://shuyuan.taobao.com/?spm=0.0.0.0.gAD0nS#!/selftutorial/detail?id=249" target="_blank">了解详情&nbsp;&gt;&gt;</a>\n                </div>\n                <div class="schedule_config radio">\n                    <div class="l">\n                        <label class="checkbox-inline"><input type="radio" class="schedule_radio" checked name="schedule_radio" value="current"/>当前设置</label>\n                        <label class="checkbox-inline"><input type="radio" class="schedule_radio" name="schedule_radio" value="100"/>全日制投放</label>\n                        <label class="checkbox-inline"><input type="radio" class="schedule_radio" id="select_template" name="schedule_radio"/>快捷模板</label>\n                        <div class="select_warp ml0" id="search_schedule">\n                            <span class="form tip" data-toggle="dropdown">请选择...&emsp;&emsp;&emsp;&emsp;&nbsp;</span>\n                            <ul class="dropdown-menu">\n                                <li data-value="-1"><span class="schedule_type">请选择......&emsp;&emsp;&emsp;&emsp;</span></li>\n                                {{ each templets }}\n                                    <li data-value="-1"><span class="schedule_type">{{ $value.type }}</span></li>\n                                    {{ each $value.list as templet index }}\n                                    <li data-value="{{ templet.id }}"><span>{{ templet.name }}</span></li>\n                                    {{ /each }}\n                                {{ /each }}\n                            </ul>\n                        </div>\n                        <div class="select_warp ml0" id="select_batch">\n                            <span class="form tip" data-toggle="dropdown">全部增加</span>\n                            <ul class="dropdown-menu">\n                                <li data-value="1"><span class="active">全部增加</span></li>\n                                <li data-value="-1"><span>全部减少</span></li>\n                            </ul>\n                        </div>\n                        <div class="form-inline pull-right" autocomplete="on">\n                          <div class="form-group">\n                              <div class="input-group">\n                                  <input type="text" maxlength="3" class="form-control" id="batch_value">\n                                  <div class="input-group-addon" >%</div>\n                              </div>\n                          </div>\n                        </div>\n                    </div>\n                    <div class="opt_btn r w180 tr">\n                        <button class="btn btn-default bluk_set" value="-1">恢复上一步</button>\n                        <button class="btn btn-default bluk_set" value="0">清空</button>\n                    </div>\n                </div>\n                <div class="duration">\n                    <ul class="header">\n                        <li class="l info">星期\\时间</li>\n                        <li class="l time">\n                            <div class="num">00:00 - 06:00</div>\n                            <ul class="detail clearfix">\n                                <li class="digital l">0</li>\n                                <li class="digital l">1</li>\n                                <li class="digital l">2</li>\n                                <li class="digital l" >3</li>\n                                <li class="digital l">4</li>\n                                <li class="digital l last">5</li>\n                            </ul>\n                        </li>\n                        <li class="l time">\n                            <div class="num">06:00 - 12:00</div>\n                            <ul class="detail clearfix" >\n                                <li class="digital l">6</li>\n                                <li class="digital l">7</li>\n                                <li class="digital l">8</li>\n                                <li class="digital l">9</li>\n                                <li class="digital l">10</li>\n                                <li class="digital l last">11</li>\n                            </ul>\n                        </li>\n                        <li class="l time">\n                            <div class="num" >12:00 - 18:00</div>\n                            <ul class="detail clearfix">\n                                <li class="digital l">12</li>\n                                <li class="digital l">13</li>\n                                <li class="digital l">14</li>\n                                <li class="digital l">15</li>\n                                <li class="digital l">16</li>\n                                <li class="digital l last">17</li>\n                            </ul>\n                        </li>\n                        <li class="l time">\n                            <div class="num">18:00 - 24:00</div>\n                            <ul class="detail clearfix">\n                                <li class="digital l">18</li>\n                                <li class="digital l">19</li>\n                                <li class="digital l">20</li>\n                                <li class="digital l">21</li>\n                                <li class="digital l">22</li>\n                                <li class="digital l last">23</li>\n                            </ul>\n                        </li>\n                    </ul>\n                    <div class="content">\n                        <ul class="l week">\n                            <li class="day">星期一</li>\n                            <li class="day">星期二</li>\n                            <li class="day">星期三</li>\n                            <li class="day">星期四</li>\n                            <li class="day">星期五</li>\n                            <li class="day">星期六</li>\n                            <li class="day">星期天</li>\n                        </ul>\n                        <ul class="boxzone" id="selectable">\n                            {{each liObjList}}<li class="box" id="duration_box_{{$index}}" box-index="{{$index}}" data-num=0 ></li>{{/each}}\n                        </ul>\n                    </div>\n                </div>\n                <div class="mt10 mb10">\n                    <span class="f12 item_dark">可以拖拽鼠标选择投放时间段</span>\n                    <span class="r">\n                        <button class="btn btn-primary submit">提交</button>\n                        <button class="btn btn-default" data-dismiss="modal">取消</button>\n                    </span>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n',s='<div id="duration_setting" class="duration_setting" tabindex="-1">\n    <div>\n        <span id="day_desc"></span>： <strong class="" id="time_desc"></strong>\n    </div>\n    <div class="mt20 mb10">\n        <div class="r error-right w160 mr10">\n            <input id="duration_setting_discount" type="slider" name="discount" value="100">\n        </div>\n        <label class="n db poi f12" id="duration_discount">\n            <input type="radio" value=2 name="duration_setting" class="vn" checked>自定义：\n        </label>\n        <label class="n db poi f12" id="duration_setting_set100">\n            <input type="radio" value=1 name="duration_setting" class="vn">无折扣<span class="g9">（即100%比例投放）</span>\n        </label>\n        <label class="n db poi f12" id="duration_setting_setdefault" >\n            <input type="radio" value=0 name="duration_setting" class="vn">不投放\n        </label>\n    </div>\n    <div class="tc">\n        <button class="btn btn-small btn-primary submit">确定</button>\n        <button class="btn btn-small close_duration">取消</button>\n    </div>\n</div>\n<div id="duration_hover" class="duration_hover">\n    <div> <span id="duration_hover_week">---</span> ： </div>\n    <div> <strong id="duration_hover_time">--:-- - --:--</strong><strong class="ml5" id="duration_hover_discount">---</strong> %折扣 </div>\n</div>\n';var n=function(){$(".ui-selected").removeClass("ui-selected"),$("#duration_setting").fadeOut()},d=function(t){this.options=t},o="0",c=[],r=1,u=0;d.prototype.day_desc_list=["星期一","星期二","星期三","星期四","星期五","星期六","星期天"],d.prototype.time_desc_list=["00:00","00:30","01:00","01:30","02:00","02:30","03:00","03:30","04:00","04:30","05:00","05:30","06:00","06:30","07:00","07:30","08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00","18:30","19:00","19:30","20:00","20:30","21:00","21:30","22:00","22:30","23:00","23:30","24:00"],d.prototype.show=function(t){this.show_modal(t),this.init_data()},d.prototype.show_modal=function(i){for(var l=[],n=0;336>n;n++)l.push(n);var d=a.templets,o=t.compile(e)({liObjList:l,templets:d});this.obj=$(o),$("body").append(this.obj).append(s),$("#selectable").selectable(),this.obj.modal(),this.bind_event(i)},d.prototype.init_data=function(){"all"==this.options.schedules&&(this.options.schedules="00:00-24:00:100;00:00-24:00:100;00:00-24:00:100;00:00-24:00:100;00:00-24:00:100;00:00-24:00:100;00:00-24:00:100"),o=this.options.schedules,c.push(o),this.draw_data(o)},d.prototype.draw_data=function(t,i){for(var l=t.split(";"),a=0;a<l.length;a++)if("0"==l[a])for(var e=48*a;48*(a+1)>e;e++)$("#duration_box_"+e).attr("class","box ui-selectee li_bgcolor_0").data("num",0);else{var s=l[a].split(",");for(var n in s){var o=s[n].slice(0,11).split("-"),c=s[n].slice(12),u=$.inArray(o[0],d.prototype.time_desc_list),p=$.inArray(o[1],d.prototype.time_desc_list)-1,_=1;i>0&&(c=parseInt(c)+i*r,c=Math.min(Math.max(30,c),250),c=parseInt(c)),100!=c&&(_=parseInt(c/10));for(var e=u+48*a;p+48*a>=e;e++)$("#duration_box_"+e).attr("class","box ui-selectee li_bgcolor_"+_).data("num",c)}}},d.prototype.bind_event=function(t){var i=this;$("#selectable").selectable(),$("#duration_discount input")[0].checked=!0,$("#selectable").on("mousedown",function(){n()}),$("#duration_setting").on("click",".close_duration",function(){n()}),$("#selectable").on("mouseup",function(){var t=$(this).find(".ui-selecting"),l=$("#duration_setting"),a=[],e=[],s=0,n=0,d=0;if(t.each(function(){d=parseInt($(this).attr("box-index")),s=parseInt(d/48),-1==$.inArray(s,a)&&a.push(s),n=d%48,-1==$.inArray(n,e)&&e.push(n)}),0!==a.length){var o=i.day_desc_list[a[0]]+" - "+i.day_desc_list[a[a.length-1]],c=i.time_desc_list[e[0]]+" - "+i.time_desc_list[e[e.length-1]+1];1==a.length&&(o=i.day_desc_list[a[0]]),l.find("#day_desc").text(o),l.find("#time_desc").text(c);var r=t.eq(0),u=parseInt(t.eq(0).attr("box-index")),p=parseInt(t.eq(t.length-1).attr("box-index")),_=r.offset().left+(p-u+1)%48/2*15,h=r.offset().top-window.scrollY+(parseInt(p/48)-parseInt(u/48)+1)/2*60,v=$(window).height()-l.outerHeight(),m=v>h?h:v;l.css({"margin-left":_,"margin-top":m}).fadeIn()}}),$("#selectable li").on("mousemove",function(t){var l=t.pageX+10,a=t.pageY-window.scrollY+14,e=parseInt($(this).data("num")),s=parseInt($(this).attr("box-index")),n=parseInt(s/48),d=parseInt(s%48),o=i.time_desc_list[d]+" - "+i.time_desc_list[d+1];$("#duration_hover_week").text(i.day_desc_list[n]),$("#duration_hover_time").text(o),$("#duration_hover_discount").text(e),$("#duration_hover").stop().css({"margin-left":l,"margin-top":a}).fadeIn()}),$("#selectable").on("mouseleave",function(){$("#duration_hover").hide()}),$("#duration_setting_discount").slider({from:30,to:250,step:5,range:"min",skin:"showvalue",dimension:"&nbsp;%",onstatechange:function(t){var i=$("#duration_setting_discount").closest("div");$("#duration_discount input")[0].checked=!0,i.find(".jslider-bg .v").css("width",parseFloat(100*(t-30))/220+"%")}}),$("#modal_camp_schedule").on("hide",function(){$("#duration_setting").stop().hide()}),$("#modal_camp_schedule").on("click",".bluk_set",function(){var t=parseInt($(this).val());if(0>t){if(c.length<=1)return l.show("已经恢复到初始设置！"),!1;d.prototype.draw_data(c[c.length-1]),c.pop()}else{c.push(p());var i=t>0?"li_bgcolor_1":"li_bgcolor_0";$("#selectable>li").attr("class","box ui-selectee "+i).data("num",t)}}),$("#duration_setting").on("click",".submit",function(){c.push(p());var t=parseInt($("input[name='duration_setting']:checked").val());t=t>1?parseInt($("#duration_setting_discount").val()):100*t;var i=parseInt(t/10),l="box ui-selectee li_bgcolor_1";100!=t&&(l="box ui-selectee li_bgcolor_"+i),$(".ui-selected").attr("class",l).data("num",t),$("#duration_setting").fadeOut()}),$(document).on("click",function(t){$("#selectable")[0]!=t.target&&n()}),$("#duration_setting").on("click",function(t){t.stopPropagation()}),this.obj.find(".btn-primary").on("click",function(){var a=p();return";;;;;;"==a?(l.show("计划投放时间不能为空!"),!1):(i.obj.modal("hide"),t.schedules==a?!1:void(i.options.onChange&&i.options.onChange(a)))}),this.obj.on("hidden.bs.modal",function(){i.obj.remove(),o="0",c=[],r=1,u=0}),$("#search_schedule").click(function(){$("#select_template").prop("checked",!0)}),$("#search_schedule").on("change",function(t,i){c.push(p()),u=0,$("#batch_value").val(""),d.prototype.draw_data(a.getTempletValue(i))}),$(".schedule_type").click(function(t){t.stopPropagation()}),$(".schedule_radio").on("change",function(){c.push(p());var t=$("[name=schedule_radio]:checked").val();u=0,$("#batch_value").val(""),"current"==t?d.prototype.draw_data(o):"100"==t&&$("#selectable>li").attr("class","box ui-selectee li_bgcolor_1").data("num",100)}),$("#select_batch").on("change",function(t,i){return r==i?!1:(r=i,c.push(p()),u=$("#batch_value").val(),void d.prototype.draw_data(p(),u))}),$("#batch_value").on("keyup",function(){$(this).val($(this).val().replace(/[^\d]/g,""))}),$("#batch_value").focus(function(){$(this).tooltip("hide")}),$("#batch_value").blur(function(){var t=$(this).val();return""==t||u==parseInt(t)?!1:(c.push(p()),u=parseInt(t),void d.prototype.draw_data(p(),u))})};var p=function(){var t,i=$("#selectable li"),l=0,a=0,e=0,s=0,n=0,o=0,c="";return i.each(function(){l=$(this).attr("box-index"),a=$(this).data("num"),n=l%48,e=parseInt(l/48),0===n?(o=a,s=0,t=[]):(a!=o&&(0!=o&&(c+=d.prototype.time_desc_list[s]+"-"+d.prototype.time_desc_list[n]+":"+o+","),s=n,o=a),47==n&&(c+=0!=o?d.prototype.time_desc_list[s]+"-"+d.prototype.time_desc_list[48]+":"+o+";":"0;"))}),c=c.slice(0,-1)};return{show:function(t){var i=new d(t);i.show(t)}}});