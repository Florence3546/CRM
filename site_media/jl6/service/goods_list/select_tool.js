define("jl6/site_media/service/goods_list/select_tool",["jl6/site_media/plugins/artTemplate/template","jl6/site_media/widget/alert/alert","jl6/site_media/widget/confirm/confirm","jl6/site_media/widget/lightMsg/lightMsg","jl6/site_media/widget/ajax/ajax","jl6/site_media/widget/loading/loading"],function(t,e,o,s,a,n){var i=function(i,d,l){var u,f='<div class="select-tool select-fixed">\n    <input type="checkbox" class="select-all">&nbsp;全选&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;已选宝贝 <a><strong class="select_rows f20">0</strong></a> 个\n    <button class="btn btn-primary btn-sm ml10 batch-opt" opt_type="1">开启推广</button>\n    <button class="btn btn-primary btn-sm ml10 batch-opt" opt_type="2">暂停推广</button>\n    <button class="btn btn-primary btn-sm ml10 batch-opt" opt_type="3">批量删除</button>\n    {{ if list_type==\'2\' || list_type==\'4\' }}\n    <div class="btn-group ml10 quick_oper">\n        <button class="btn btn-primary btn-sm batch-opt" opt_type="4">加大投入</button>\n        <button class="btn btn-primary btn-sm batch-opt" opt_type="5">减少投入</button>\n    </div>\n    {{ /if }}\n    <!--\n    {{ if list_type==\'1\' || list_type==\'3\' }}\n    <span class="dropup ml10">\n      <button class="btn btn-sm btn-primary dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">\n        优化设置\n        <span class="caret"></span>\n      </button>\n      <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">\n        <li><a href="javascript:;" class="batch-opt" opt_type="6">自动优化</a></li>\n        <li><a href="javascript:;" class="batch-opt" opt_type="7">只改价</a></li>\n        <li><a href="javascript:;" class="batch-opt" opt_type="8">不托管</a></li>\n      </ul>\n    </span>\n    {{ /if }}\n    -->\n</div>';u=t.compile(f)({list_type:i}),$("#goods_table").after($(u)),_();var b=$(window).height(),g=$(window).scrollTop();$("#goods_table tbody tr:first").offset().top+50>g+b&&$(".select-tool").addClass("hide"),$(window).scroll(function(){$(".select-tool").removeClass("hide");var t=$(".page-tool").offset().top+10,e=$(window).scrollTop(),o=$(window).height();e+o>t?$(".select-tool").removeClass("select-fixed"):$(".select-tool").addClass("select-fixed"),$("#goods_table tbody tr:first").offset().top+50>e+o&&$(".select-tool").addClass("hide")}),$(window).resize(function(){var t=$(".page-tool").offset().top+10,e=$(window).height();e>t?$(".select-tool").removeClass("select-fixed"):$(".select-tool").addClass("select-fixed"),$(".select-tool").removeClass("hide")}),$(".select-tool").on("click",".batch-opt",function(){var t=parseInt(r());if(0>=t)return e.show("还未选择任何宝贝！"),!1;var s=parseInt($(this).attr("opt_type"));switch(s){case 1:o.show({body:"确定要启动推广所选的"+t+"个宝贝吗？",okHide:function(){y("start")}});break;case 2:o.show({body:"确定要暂停推广所选的"+t+"个宝贝吗？",okHide:function(){y("stop")}});break;case 3:o.show({body:"即将删除所选的"+t+"个宝贝，删除后将在直通车后台消失且无法恢复，确认要删除吗？",okHide:function(){y("del")}});break;case 4:m(1);break;case 5:m(0);break;case 6:h(1);break;case 7:h(2);break;case 8:h(0)}});var h=function(t){var e="确定要将选中的宝贝设置为自动优化吗？";2==t?e="确定要将选中的宝贝设置为只改价吗？":0==t&&(e="确定要将选中的宝贝取消托管吗？");var n=p(),l=$.map(n,function(e){var o=$(e).find(".mnt_opt_type").attr("mnt_opt_type");return o!=t?parseInt($(e).attr("adgroup_id")):void 0});l.length&&o.show({body:e,okHidden:function(){a.ajax("update_adgs_mnt",{camp_id:d,adg_id_list:l,mnt_type:i,flag:t},function(t){for(var e=t.success_list,o=0;o<e.length;o++){var a=$("#goods_table tr[adgroup_id="+e[o]+"]"),n="自动优化",i=1;if($(".mnt_num").text(t.mnt_count),$(".new_num").text(t.max_num-t.mnt_count),0==t.flag){if(n="未托管",i=3,a.find(".change_mnt_type").attr("mnt_type",0),a.find(".mnt_type_true").removeClass("hide"),a.find(".mnt_type_false").addClass("hide"),a.find(".optm_submit_time").removeClass("hide"),0==a.find(".onekey").length){var d=a.attr("adgroup_id"),l=a.attr("campaign_id"),r='<a href="javascript:;" class="onekey" adgroup_id="'+d+'" campaign_id="'+l+'"><span><strong>一键优化</strong></span></a>';a.find(".opt_url").append(r)}}else a.find(".mnt_type_false").removeClass("hide"),a.find(".mnt_type_true").addClass("hide"),a.find(".optm_submit_time").addClass("hide"),2==t.flag&&(n="只改价",i=2),a.find(".onekey").remove();a.find(".opt_status").text(n),a.find(".sort_value").text(i),a.find(".mnt_opt_type").attr("mnt_opt_type",t.flag)}s.show({body:"操作成功！"})},null,{url:"/mnt/ajax/"})}})},m=function(t){var n=p(),l=$.map(n,function(t){return $(t).attr("is_quick_opered")&&"0"!=$(t).attr("is_quick_opered")?void 0:parseInt($(t).attr("adgroup_id"))});return l.length?void o.show({body:"确定要优化选中的宝贝?",okHide:function(){a.ajax("quick_oper",{campaign_id:d,adg_id_list:l,mnt_type:i,stgy:t},function(){for(var t=0;t<l.length;t++)$("#goods_table tr[adgroup_id="+l[t]+"]").attr("is_quick_opered","1");s.show({body:"操作成功！"})},null,{url:"/mnt/ajax/"})}}):void e.show("所选宝贝今日全部优化过，不能再优化了（每天只能优化一次）")},y=function(t){var e=c("adgroup_id");n.show("正在执行，请稍候..."),a.ajax("update_adg_status",{mode:t,mnt_type:1,campaign_id:0,adg_id_list:"["+e.toString()+"]"},v)},v=function(t){switch(t.mode){case"start":for(var e=0;e<t.success_id_list.length;e++){var o=t.success_id_list[e];$("#goods_table tr[adgroup_id="+o+"] .lbl_online").html("推广中"),$("#goods_table tr[adgroup_id="+o+"] .switch_status").html("暂停"),$("#goods_table tr[adgroup_id="+o+"] .sort_online").text(1),$("#goods_table tr[adgroup_id="+o+"]").removeClass("gray")}break;case"stop":for(var e=0;e<t.success_id_list.length;e++){var o=t.success_id_list[e];$("#goods_table tr[adgroup_id="+o+"] .lbl_online").html("已暂停"),$("#goods_table tr[adgroup_id="+o+"] .switch_status").html("开启"),$("#goods_table tr[adgroup_id="+o+"] .sort_online").text(0),$("#goods_table tr[adgroup_id="+o+"]").addClass("gray")}break;case"del":s.show({body:"宝贝删除成功！"}),l()}n.hide()}},d=function(){var t=0;$("#goods_table").find(".kid_check").each(function(){$(this).prop("checked")&&t++}),$(".select_rows").text(t)},l=function(t){$(".select_rows").text(t),0==t&&$(".select-all").prop("checked",!1)},r=function(){return $(".select_rows").text()},c=function(t){t||(t="adgroup_id");var e=[];return $("#goods_table").find(".kid_check").each(function(){$(this).prop("checked")&&e.push($(this).parents("tr").attr(t))}),e},p=function(){var t=[];return $("#goods_table").find(".kid_check").each(function(){$(this).prop("checked")&&t.push($(this).parents("tr"))}),t},_=function(){var t=$(".page-tool").offset().top+10,e=$(window).height();e>t?$(".select-tool").removeClass("select-fixed"):$(".select-tool").addClass("select-fixed")},u=function(){$(".select-tool").css("display","block")},f=function(){$(".select-tool").css("display","none")};return{init:i,refreshSelected:d,setSelected:l,getSelected:r,getSelectParams:c,fixPosition:_,getSelectObjs:p,show:u,hide:f}});