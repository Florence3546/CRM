define("jl6/site_media/service/my_message/msg_dialog",["require","jl6/site_media/plugins/artTemplate/template","jl6/site_media/widget/alert/alert","jl6/site_media/widget/ajax/ajax","jl6/site_media/widget/templateExt/templateExt","jl6/site_media/service/common/poster_store"],function(a,e,i,n,s,l){"use strict";var d,t,o;d='<div id="myMsgDialog" class="modal fade">\n    <div class="modal-dialog w1000">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n                <h4 class="modal-title">我的消息</h4>\n            </div>\n\n            <div class="modal-body">\n                <div class="page mb20">\n                </div>\n                <div class="content">\n                  <div class="text-center">\n                    <img src="/site_media/jl6/static/images/ajax_loader.gif" alt=""><br>\n                    <span>请稍候...</span>\n                  </div>\n                </div>\n            </div>\n\n        </div>\n    </div>\n</div>\n',t='<div id="tab_msg" class="tab-pane active">\n  <div class="accordion" id="accordion1">\n    {{each list as value index }}\n    <div class="accordion-group">\n        <div class="accordion-heading">\n            <a href="#collapse_cm_{{value.id}}" data-parent="#accordion1" data-toggle="collapse" id="title_common_{{value.id}}" class="accordion-toggle black collapsed {{if !value.is_read}}close_msg{{/if}}" data="{{value.id}}" >\n                <span id="lbl_read_{{value.id}}" class="label {{if value.is_read}}label-default{{else}}label-primary{{/if}}">{{if value.is_read}}已读{{else}}未读{{/if}}</span>\n                <span class="color-{{value.level}}">\n                   {{value.title}}\n                </span>\n                <span class="r gray"> {{value.last_modified}}</span>\n            </a>\n        </div>\n        <div class="accordion-body collapse" id="collapse_cm_{{value.id}}">\n            <div class="accordion-inner">{{value.content}}\n            </div>\n        </div>\n    </div>\n    {{/each}}\n  </div>\n</div>\n';var c=function(){var a=e.compile(d)();e.config("escape",!1),o=$(a),$("body").append(o),o.modal(),o.on("shown.bs.modal",function(){r(1)}),o.on("hidden.bs.modal",function(){o.remove()}),o.on("click",".close_msg",function(){var a=$(this),e=a.attr("data");n.ajax("read_message",{msg_id:e},function(i){if(""==i.errMsg){$("#lbl_read_"+e).removeClass("label-primary").addClass("label-default").text("已读");var n=parseInt($("#msg_count").text());n>0&&(n--,$("#msg_count").text(n),a.removeClass("close_msg"),l.setUnreadCount(n))}})})},r=function(a){n.ajax("get_message_list",{page:a},function(a){m(a.msg_list),v(a.page_info)})},m=function(a){var i=e.compile(t)({list:a});o.find(".content").html(i)},v=function(e){a(["jl6/site_media/widget/pageBar/pageBar"],function(a){var i=a.show({data:e,onChange:function(a){r(a)}});o.find(".page").html(e.record_count>0?i:"<span>暂无私信</span>")})};return{show:c}});