define("jl6/site_media/service/rob_rank/real_time",["jl6/site_media/plugins/artTemplate/template","jl6/site_media/widget/ajax/ajax","jl6/site_media/widget/alert/alert","jl6/site_media/plugins/moment/moment.min"],function(t,i,a,e){"use strict";var n,s='<div class="modal fade" id="real_time">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n                <h4 class="modal-title">“{{word}}”抢排名趋势，<span class="finished_status">正在抢......，请勿关闭窗口</span></h4>\n            </div>\n            <div class="modal-body">\n                <table class="main_info">\n                    <tr>\n                        <td><span class="img">&emsp;</span>{{if platform == \'pc\'}}计算机{{else}}移动{{/if}}出价：<span class="price">--</span>&ensp;元</td>\n                        <td class="msg">&emsp;</td>\n                        <td>\n                            <div class="btn-group show_model mt-1">\n                                <a class="btn btn-sm active" data-type="rob_chat"><i class="iconfont b">&#xe64a;</i></a>\n                                <a class="btn btn-sm" data-type="rob_sub_info"><i class="iconfont b">&#xe640;</i></a>\n                            </div>\n                        </td>\n                    </tr>\n                </table>\n                <div id="rob_chat" class="mt10" style="min-width:300px;height:240px"></div>\n                <div class="sub_info hide" id="rob_sub_info">\n                    <ol>\n                    </ol>\n                </div>\n                <div class="gray f12">\n                    当前设置：{{if method == \'manual\'}}手动{{else}}自动{{/if}}，{{if platform == \'pc\'}}计算机{{else}}移动{{/if}}，限价:{{limit}}，{{rank_start_name}}~{{rank_end_name}}\n                </div>\n                <div class="red f12 mt5 hide" id="rob_tips">设置抢排名成功，正在测试</div>\n            </div>\n            <div class="modal-footer">\n                <button type="button" class="btn btn-sm btn-default reset">重新设置</button>\n                <button type="button" class="btn btn-sm btn-primary" data-dismiss="modal">关闭</button>\n            </div>\n        </div>\n    </div>\n</div>\n',r=function(i){var a,e,n=!1;a=t.compile(s)(i),e=$(a),$("body").append(e),e.modal({backdrop:"static"}),"auto"==i.method&&e.find("#rob_tips").removeClass("hide"),e.on("shown.bs.modal",function(){var t=this;d(i),m(i),$(this).find(".reset").on("click",function(){n=!0,$(t).modal("hide")})}),e.on("hidden.bs.modal",function(){n&&$("#"+i.keywordId).trigger("show.rob",[i]),$(this).remove(),c()}),e.find(".show_model .btn").on("click",function(){var t=$(this).data().type;e.find(".show_model .btn").removeClass("active"),$(this).addClass("active"),$("#rob_chat,#rob_sub_info").addClass("hide"),$("#"+t).removeClass("hide")})},d=function(t){var i,a;i="ws://"+window.location.host+"/websocket/?keyword_id="+t.keywordId,a=new WebSocket(i),a.onmessage=function(i){if(""!=i&&void 0!=i){if("ready"==i.data)return o(t),!1;var e=$.evalJSON(i.data);l(t,e,a)}}},o=function(t){i.ajax("manual_rob_rank",{keyword_id:t.keywordId,adgroup_id:t.adgroupId,exp_rank_start:t.rank_start,exp_rank_end:t.rank_end,limit_price:parseInt(100*t.limit+.5),platform:t.platform,nearly_success:t.nearly_success},function(t){if(""!=t.limitError){var i,e;"version_limit"==t.limitError&&(i="Sorry!当前版本不支持",e='<div class="f16">亲，您订购的版本不支持手动抢排名哦，请升级到双引擎版！</div><div class="tc mt10"><button type="button" class="btn btn-primary" data-dismiss="modal">知道了</button><a class="btn btn-primary ml20" href="/web/upgrade_suggest/" target="_blank">立即升级</a></div></div>'),"others"==t.limitError&&(i="Sorry，自动抢排名失败",e='<div class="f16">亲，请刷新页面重试</div><div class="tc mt10"><button type="button" class="btn btn-primary" data-dismiss="modal">知道了</button></div></div>'),a.error_show({id:"alert_modal_fixed",backdrop:!1,title:i,footer:!1,body:e})}})},l=function(t,i,a){var n=$("#real_time"),s=$("#"+t.keywordId),r="doing";("ok"==i.result_flag||"nearly_ok"==i.result_flag)&&(n.find(".main_info").addClass("success"),n.find(".finished_status").text("抢排名成功"),n.find("#rob_tips").text("设置抢排名成功：系统将在您 指定的时间段内每隔15~30分钟自动为关键词抢排名"),s.trigger("update.rank",[i.cur_rank_dict.pc,i.cur_rank_dict.yd,i.cur_rank_dict.pc_desc,i.cur_rank_dict.yd_desc]),"auto_rob_rank"!=t.target&&"manual"==t.method&&s.trigger("update.rob_rank",["success",Number(i.price).toFixed(2),i.platform]),r="finish",a.close()),("done"==i.result_flag||"failed"==i.result_flag)&&(n.find(".main_info").addClass("fail"),n.find(".finished_status").text("抢排名失败"),n.find("#rob_tips").text("测试抢排名失败：建议你重新设置提高限价"),s.trigger("update.rank",[i.cur_rank_dict.pc,i.cur_rank_dict.yd,i.cur_rank_dict.pc_desc,i.cur_rank_dict.yd_desc]),"auto_rob_rank"!=t.target&&"manual"==t.method&&s.trigger("update.rob_rank",["fail"]),r="finish",a.close()),m(t,i),n.find("ol").append("<li class='"+r+"''><span>"+e(i.rob_time).format("H:mm:ss")+"<span class='r'>"+Number(i.price).toFixed(2)+"元</span></span><span>"+i.msg+"</span></li>"),n.find(".main_info .price").text(Number(i.price).toFixed(2)),n.find(".main_info .msg").text(i.msg)},c=function(){n=void 0},m=function(t,i){if(n){var t={y:Number(i.price),data:i.msg};("ok"==i.result_flag||"nearly_ok"==i.result_flag)&&(t.marker={fillColor:"#1ede20",states:{hover:{fillColor:"#1ede20",lineColor:"#1ede20"}}}),("done"==i.result_flag||"failed"==i.result_flag)&&(t.marker={fillColor:"#fd5726",states:{hover:{fillColor:"#fd5726",lineColor:"#fd5726"}}}),$("#rob_chat").highcharts().series[0].addPoint(t),$("#rob_chat").highcharts().series[1].addPoint({y:i.cur_rank_dict.pc,data:i.msg})}else n=$("#rob_chat").highcharts({chart:{type:"spline"},title:{text:""},subtitle:{text:""},credits:{text:""},legend:{enabled:!0},xAxis:{type:"linear",minTickInterval:1,formatter:function(){return this.value+1}},yAxis:[{title:{text:""},min:0,gridLineColor:"#ddd",gridLineDashStyle:"Dash",gridLineWidth:1},{title:{text:""},opposite:!0,min:0,gridLineColor:"#ddd",gridLineDashStyle:"Dash",gridLineWidth:1,labels:{formatter:function(){return""}}}],plotOptions:{spline:{marker:{radius:4,lineColor:"#666666",lineWidth:1}}},series:[{name:"出价",lineColor:"#76a0c6",marker:{lineWidth:0,width:8,height:8,symbol:"circle",fillColor:"#1a8bf1"}},{name:"排名",yAxis:1,lineColor:"#ccc",marker:{lineWidth:0,width:8,height:8,symbol:"circle",fillColor:"#aaa"}}],tooltip:{crosshairs:!0,shared:!0,formatter:function(){return"当前出价:"+this.y.toFixed(2)+"<br/>"+this.points[0].point.data}}})};return{show:r}});