define("jl6/site_media/service/rob_rank/rob_rank",["jl6/site_media/plugins/artTemplate/template","jl6/site_media/widget/ajax/ajax","jl6/site_media/widget/alert/alert","jl6/site_media/widget/confirm/confirm","jl6/site_media/service/rob_rank/real_time","jl6/site_media/plugins/store/store.min","jl6/site_media/widget/jqueryExt/serializeObject","jl6/site_media/plugins/jslider/js/jquery.slider","jl6/site_media/widget/templateExt/templateExt"],function(e,t,n,a,i){"use strict";var r,s,r='<div class="modal fade" id="rob_rank">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <h4 class="modal-title">"{{word}}"抢排名设置</h4>\n            <div class="modal-body">\n                <div class="fix mb10">\n                    <img src="{{picUrl}}" class="item_img l">\n                    <div class="l ml20">\n                        <div>计划名称：{{campaignTitle}}</div>\n                        <div>宝贝名称：{{itemTitle}}</div>\n                    </div>\n                </div>\n                <hr>\n                <form>\n                    <div>\n                        抢位方式：\n                        <label class="radio-inline">\n                          <input type="radio" name="method" {{if method=="manual"}}checked{{/if}} value="manual">手动&emsp;\n                        </label>\n\n                        <label class="radio-inline ml40">\n                          <input type="radio" name="method" {{if method=="auto"}}checked{{/if}} value="auto">自动\n                        </label>\n                        <span class="text-muted ml20 hide manual_info">(手动抢排名时，请不要刷新界面)</span>\n                        <div class="slider">\n                            <input type="text" class="hide" value="{{if start_time!=undefined }}{{start_time}}{{else}}480{{/if}};{{if end_time!=undefined }}{{end_time}}{{else}}1024{{/if}}">\n                        </div>\n                    </div>\n                    <div class="mt15">\n                        抢位平台：\n                        <label class="radio-inline">\n                          <input type="radio" name="platform" {{if platform=="pc"}}checked{{/if}} value="pc">计算机\n                          <span class="ml20">\n                              （当前出价：{{maxPrice | format:\'1,1,2\'}}元，{{qscore}}分，<span class="pc_rank">{{pcRank}}</span>）\n                          </span>\n                        </label>\n                    </div>\n                    <div class="mt15">\n                        &emsp;&emsp;&emsp;&emsp;&emsp;\n                        <label class="radio-inline">\n                          <input type="radio" name="platform" {{if platform=="yd"}}checked{{/if}} value="yd">移动&emsp;\n                          <span class="ml20">\n                              （当前出价：{{maxMobilePrice | format:\'1,1,2\'}}元，{{if wirelessQscore>0 }}{{wirelessQscore}}分{{/if}}，<span class="yd_rank">{{ydRank}}</span>）\n                          </span>\n                        </label>\n                    </div>\n                    <div class="mt15 text-muted ml20 platform_info hide">\n                        &emsp;&emsp;&emsp;&emsp;质量得分较低，建议不要抢高排名\n                    </div>\n                    <div class="mt15">\n                        期望排名：\n                        <select name="rank_start">\n                            <option value="">请选择平台</option>\n                        </select>\n                        &ensp;至&ensp;\n                        <select name="rank_end">\n                            <option value="">请选择平台</option>\n                        </select>\n                    </div>\n                    <div class="mt15">\n                        最高限价：\n                        <input type="text" autocomplete="off" maxlength="5" name="limit" class="form-control w50" value="{{limit}}">&ensp;元\n                    </div>\n                    <div class="mt15">\n                        抢位失败：\n                        <label class="radio-inline">\n                          <input type="radio" name="nearly_success" {{if nearly_success=="1" || nearly_success == undefined }}checked{{/if}} value="1">接近期望排名时保留出价\n                        </label>\n                        <label class="radio-inline">\n                          <input type="radio" name="nearly_success" {{if nearly_success=="0"}}checked{{/if}} value="0">恢复为原价\n                        </label>\n                    </div>\n                </form>\n                <div class="red mt15">免责声明：抢位可能导致花费过高，如因抢排名导致效果不佳，与精灵无关</div>\n            </div>\n            <div class="modal-footer">\n                <button type="button" class="btn btn-sm btn-default" data-dismiss="modal">取消</button> \n                {{if method == "auto"}}<button type="button" class="btn btn-sm btn-default rob_cancle">取消自动抢</button> {{/if}}\n                <button type="button" class="btn btn-sm btn-primary submit">确定</button>\n            </div>\n        </div>\n    </div>\n</div>\n',d=function(e){s=!1;var t=$("#item_title").text(),n=$("#campaign_title").text(),a=$("#adg_nav .adg_img_warp>img:eq(0)").attr("src");if(""==t||""==n){var i=$("#"+e.keywordId).find(".img_box img").data();t=i.title,n=i.campTitle,a=i.picUrl}e=$.extend({},e,{itemTitle:t,campaignTitle:n,picUrl:a,target:document.body.id}),l(e)},l=function(t){var n,a;t.start_time&&isNaN(t.start_time)&&(t.start_time=p(t.start_time)),t.end_time&&isNaN(t.end_time)&&(t.end_time=p(t.end_time)),n=e.compile(r)(t),a=$(n),$("body").append(a),a.modal(),a.on("shown.bs.modal",function(){m.apply(this,[t])}),a.on("hidden.bs.modal",function(){c.apply(this,[t])})},o=function(e,t,n,a){var i='<option value="">--请选择--</option>';for(var r in n)i+='<option value="'+r+'" '+(a==r?"selected":"")+">"+n[r]+"</option>";$(e).find("select[name="+t+"]").html(i)},m=function(e){var i=this;$(document).on("batch_rt_kw_rank",function(t,n){$(i).find(".pc_rank").text(n[e.keywordId].pc_rank_desc),$(i).find(".yd_rank").text(n[e.keywordId].mobile_rank_desc)}),$(this).find(".slider input").slider({skin:"plastic",from:0,to:1440,step:15,calculate:function(e){return _(e)}}),$(this).find(".slider").removeClass("vh").addClass("hide"),$(this).find("input[name=method]").on("change",function(){var e=$(i).find(".manual_info"),t=$(i).find(".slider");"auto"==this.value?(t.removeClass("hide"),e.addClass("hide")):(t.addClass("hide"),e.removeClass("hide"))}),"auto"==e.method&&$(this).find(".slider").removeClass("hide"),"manual"==e.method&&$(this).find(".manual_info").removeClass("hide"),$(this).find("input[name=platform]").on("change",function(){$(".platform_info",i).addClass("hide"),"pc"==this.value&&(o(i,"rank_start",e.rank_desc_map.pc_start,e.rank_start),o(i,"rank_end",e.rank_desc_map.pc_end,e.rank_end),e.qscore<=5&&$(".platform_info",i).removeClass("hide").find("span").text("PC端")),"yd"==this.value&&(o(i,"rank_start",e.rank_desc_map.yd_start,e.rank_start),o(i,"rank_end",e.rank_desc_map.yd_end,e.rank_end),e.wirelessQscore<=5&&$(".platform_info",i).removeClass("hide").find("span").text("移动端"))}),e.platform&&$(this).find("input[value="+e.platform+"]").trigger("change"),$(this).find(".submit").on("click.submit",function(){var a,r="";if(a=$(i).find("form").serializeObject(),a.method||(r+="请选择抢位方式</br>"),a.platform||(r+="请选择抢位平台</br>"),(""==a.rank_start||""==a.rank_end||Number(a.rank_end)<Number(a.rank_start))&&(r+="请正确填写期望排名,后面排名大于或等于前面排名</br>"),(!a.limit||isNaN(a.limit)||Number(a.limit)<.05||Number(a.limit)>99.99)&&(r+="请正确填写最高限价,限价必须是0.05到99.99的整数</br>"),a.nearly_success||(r+="请选择抢位不成功出价设置"),""!=r)return n.fixedShow(r),!1;if("auto"==a.method){var d,l;return d=_(Number($("#rob_rank").find(".slider input").val().split(";")[0])),l=_(Number($("#rob_rank").find(".slider input").val().split(";")[1])),t.ajax("auto_rob_rank",{keyword_id:e.keywordId,exp_rank_start:a.rank_start,exp_rank_end:a.rank_end,limit_price:parseInt(100*a.limit+.5),platform:a.platform,start_time:d,end_time:l,nearly_success:a.nearly_success},function(e){if(""!=e.limitError){var t,a;"version_limit"==e.limitError&&(t="Sorry!当前版本不支持",a='<div class="f16">亲，您订购的版本不支持自动抢排名哦，请升级到旗舰版吧！</div><div class="tc mt10"><button type="button" class="btn btn-primary" data-dismiss="modal">知道了</button><a class="btn btn-primary ml20" href="/web/upgrade_suggest/" target="_blank">立即升级</a></div></div>'),"nums_limit"==e.limitError&&(t="Sorry，自动抢排名关键词个数已达上限",a='<div class="f16">亲，自动抢位的关键词已达到50个上限！</div><div class="tc mt10"><button type="button" class="btn btn-primary" data-dismiss="modal">知道了</button></div></div>'),"others"==e.limitError&&(t="Sorry，自动抢排名失败",a='<div class="f16">亲，请刷新页面重试</div><div class="tc mt10"><button type="button" class="btn btn-primary" data-dismiss="modal">知道了</button></div></div>'),n.error_show({id:"alert_modal_fixed",backdrop:!1,title:t,footer:!1,body:a})}else s=!0,$(i).modal("hide")}),!1}s=!0,$(i).modal("hide")}),$(this).on("click.rob_cancle",".rob_cancle",function(){var n=$("#"+e.keywordId);a.show({body:"您确定取消“"+e.word+"”的自动抢排名吗？",backdrop:!1,okHidden:function(){t.ajax("rob_cancle",{keyword_id:e.keywordId},function(){"auto_rob_rank"==e.target?(n.trigger("delete_row",[e.keywordId]),$(".keywords_count").text($("#keyword_table tbody>tr").length)):n.trigger("update.rob_rank",["nomal"]),s=!1,$(i).modal("hide")})}})})},c=function(e){if(s){var t=$(this).find("form").serializeObject(),n=$("#"+e.keywordId);if(t.rank_start_name=$("[name=rank_start] option:selected").text(),t.rank_end_name=$("[name=rank_end] option:selected").text(),i.show($.extend({},e,t)),"auto_rob_rank"!=e.target&&n.trigger("update.rob_rank",["doing"]),"auto"==t.method){"auto_rob_rank"==e.target?(n.find(".platform").text("pc"==t.platform?"计算机":"移动"),"pc"==t.platform?(n.find(".exp_rank_start").text(e.rank_desc_map.pc_start[t.rank_start]),n.find(".exp_rank_end").text(e.rank_desc_map.pc_end[t.rank_end])):(n.find(".exp_rank_start").text(e.rank_desc_map.yd_start[t.rank_start]),n.find(".exp_rank_end").text(e.rank_desc_map.yd_end[t.rank_end])),n.find(".limit_price").text(Number(t.limit).toFixed(2))):n.trigger("update.rob_rank",["auto"])}n.trigger("saveOptions.rank",[t])}$(this).remove()},_=function(e){var t=Math.floor(e/60),n=e-60*t;return(10>t?"0"+t:t)+":"+(0==n?"00":n)},p=function(e){return 60*Number(e.split(":")[0])+Number(e.split(":")[1])};return{show:d}});