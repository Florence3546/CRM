define("jl6/site_media/service/select_keyword/select_keyword",["require","jl6/site_media/plugins/artTemplate/template","jl6/site_media/widget/alert/alert","jl6/site_media/widget/ajax/ajax","jl6/site_media/widget/loading/loading","jl6/site_media/widget/lightMsg/lightMsg","jl6/site_media/widget/tagEditor/tagEditor","jl6/site_media/service/select_feedback/select_feedback","jl6/site_media/plugins/jquery.json-2.4.min","jl6/site_media/plugins/data-tables/dataTableExt","jl6/site_media/plugins/jslider/js/jquery.slider","jl6/site_media/widget/templateExt/templateExt","jl6/site_media/plugins/shiftcheckbox/jquery.shiftcheckbox","jl6/site_media/plugins/zclip/jquery.zclip.min"],function(e,t,i,n,a,o,r,c){"use strict";var s,l,d,u=[],m=[],h=[],p=[],f=5,_=15,b=5,g=$("#adgroup_id").val(),v=$("#cat_id").val(),k=$("#init_select_type").val(),y=Number($("#keyword_count_hidden").val())||0,x=200-y,w=document.body.offsetHeight,N=50,C=Number($("#max_price_limit").val()),j=[],T={},S=function(){$(".btn_search").on("click",function(){P()}),$("button.filter").on("click",function(){var e=$(this).attr("data-type"),t=F();$(this).parent().find(".filter").removeClass("active"),$(this).addClass("active"),B(),E(),setTimeout(function(){"mobile"!=e?("undefined"!=typeof T[t]&&I(T[t]),Q().fnSort([[0,"desc"]]),q()):"undefined"==typeof T[t+"Mobile"]?J():U(T[t+"Mobile"]),Q().fnSort([[0,"desc"]])},0)}),$("#keyword_cart .choose_all_column input").on("change",function(){$("#scroll_box table>tbody>tr td.check_column input").each(this.checked?function(){this.checked=!0}:function(){this.checked=!1}),et()}),$("#modify_box .btn-primary").on("click",function(){var e,t,i;e=$("#modify_box input[name=price]:checked").val(),t=$("#modify_box input[name=match]:checked").val(),e||t?(i=it(),i.length?(nt(e,i),t&&at(t,i)):o.show("没有选中的关键词"),$("#modify_box").parent().removeClass("open")):o.show("没有选择操作类型")}),$("#modify_box .btn-default").on("click",function(){$("#modify_box").parent().removeClass("open")}),$("#remove_cart").on("click",function(){var e=it();if(e.length){for(var t in e)e[t].find(".del").trigger("click");et(),$("#keyword_cart .choose_all_column input")[0].checked=!1}else o.show("没有选中的关键词")}),$(".copy_btn").zclip({path:"/site_media/jl6/plugins/zclip/ZeroClipboard.swf",copy:function(){return ot()},afterCopy:function(){o.show("已复制成功，赶紧分享给你的小伙伴吧！")}}),$(".export_btn").click(function(){var e=Q().fnSettings(),t=$.map(e.aiDisplay,function(t){var i=e.aoData[t]._aData.slice(1);return i[0]=i[0].match("(.*)</div")[1],i[0]=i[0].substr(18,i[0].length),i.join(",")});this.href="data:text/csv;charset=utf-8,﻿"+encodeURIComponent("关键词,匹配度,市场均价,展现指数,点击指数,竞争指数,市场点击率,市场转化率\n"+t.join(""))}),$(".add_page").on("click",function(){Q().find("tbody tr").each(function(){var e=this.childNodes[1].childNodes[1];e.checked=!0,V.call($(e))})}),$("#submit_keyword").on("click",function(){var e=it(),t=[];if(e.length){for(var r in e)t.push([e[r].find(".word").text(),100*Number(e[r].find(".price").val()),e[r].find(".match").data().match,null,null]);a.show("正在提交关键词"),n.ajax("batch_add_keywords",{adgroup_id:g,keyword_count:y,kw_arg_list:$.toJSON(t),init_limit_price:C},function(t){a.hide(),i.show(t.data.result_mesg),$("#count_keyword_count").text(Number($("#count_keyword_count").text())+t.data.added_keyword_count);for(var n in e)e[n].find(".del").trigger("click",!0)})}else o.show("没有选中的关键词")}),$("#select_keyword_nav>li>a").on("shown.bs.tab",function(){var e,t=F();"quick"!==t||$(this).hasClass("inited")?j=[]:(M(t),$(this).addClass("inited")),"combine"===t&&O(),rt(),E(),e="/web/select_keyword/"+t+"?adgroup_id="+g,history.pushState&&history.pushState(e,"",e)}),$("#scroll_box").on("click",".del",function(e,t){var i;if(i=$(this).parent().parent().attr("id").replace("cart_tr_",""),$(this).parent().parent().remove(),$("#"+i).length&&($("#"+i)[0].checked=!1),Y(),et(),1==t&&$("#"+i).length){var n=Q();n.fnDeleteRow(n.fnGetPosition($("#"+i).parent().parent()[0]))}}),$(".guess_elemword li").on("click",function(){var t=$(this).text();$(this).hasClass("select")?e.removeTag(t):e.getTags().length<3?e.addTag(t):o.show("最多只能选择3个核心词！")});var e=r.tagEditor($("#word_filter"),{placeholder:"点击输入框选择或输入核心词",onChange:function(){var t=e.getTags();$(".guess_elemword>li").each(function(){var e=$(this).text(),i=!1;for(var n in t)t[n]==e&&(i=!0);i?$(this).addClass("select"):$(this).removeClass("select")})}});e.focus(function(){$("#select_box").removeClass("hide")}),$(document).on("click.select_box",function(){$("#select_box").addClass("hide")}),$("#btn_tao_keyword").on("click",function(){var t=e.getTags();t.length?(s=t.join(" "),M()):i.show("亲，请先输入要包含的核心词。")}),$("#textarea_prdtword").on("keyup",function(){var e=$.trim($(this).val()).split("\n");e=$.map(e,function(e){return e?e:void 0}),$("#prdtword_count").html(e.length),u=e}),$("#textarea_dcrtword").on("keyup",function(){var e=$.trim($(this).val()).split("\n");e=$.map(e,function(e){return e?e:void 0}),$("#dcrtword_count").html(e.length),m=e}),$("#textarea_prmtword").on("keyup",function(){var e=$.trim($(this).val()).split("\n");e=$.map(e,function(e){return e?e:void 0}),$("#prmtword_count").html(e.length),h=e}),$("#btn_auto_combine_words").on("click",function(){return $("#textarea_prdtword").trigger("keyup"),$("#textarea_dcrtword").trigger("keyup"),$("#textarea_prmtword").trigger("keyup"),0===u.length?(i.show("亲，产品词至少要有一个！"),!1):u.length>f?(i.show("亲，产品词请不要超过"+f+"个！"),!1):m.length>_?(i.show("亲，属性词/修饰词请不要超过"+_+"个！"),!1):h.length>b?(i.show("亲，促销词请不要超过"+b+"个！"),!1):void M()}),$("#textarea_manual").on("keyup",function(){p=$.trim($(this).val()).split("\n"),p=$.map(p,function(e){return e?e:void 0}),$("#manual_count").html(p.length)}),$("#btn_manual_add_words").on("click",function(){return $("#textarea_manual").trigger("keyup"),0==p.length?(i.show("亲，请先输入关键词！"),!1):void M()}),$("#scroll_box").on("change","input[type=text]",function(){var e=Number(this.value);$(this).val(D(e)?e>C?Number(C).toFixed(2):e.toFixed(2):$(this).data().cpc)}),$("#max_price_limit").on("change",function(){var e=it();if(C=Number($(this).val()).toFixed(2),D(C)){for(var t in e){var i=e[t].find(".price");Number(i.val())>C&&i.val(C)}$("#max_price_limit").val(C)}else $(this).val($(this).data().old),o.show("最高限价无效")}),$(".alert").bind("closed.bs.alert",function(){d.fnUpdate()}),$("#custome_price,#custome_price_multiple").on("focus",function(){$(this).prev()[0].checked=!0}),$("#slider_input").slider({from:50,to:250,step:1,range:"min",skin:"platform",limits:!1,scale:["0.5","1.0","1.5","2.0","2.5"],onstatechange:function(e){var t=$(".slider_input[name=slider_input]").closest("div");t.find(".jslider-bg .v").css("width",parseFloat(100*(e-50))/200+"%"),$("#custome_price_multiple").val((Number(e)/100).toFixed(2))}}),$("#slider_input").on("click",function(){$("#custome_price_multiple").trigger("focus")}),$("#custome_price_multiple").on("blur",function(){return isNaN(this.value)||this.value<.5||this.value>2.5?(this.value=(Number($("#slider_input").slider("value"))/100).toFixed(2),!1):void $("#slider_input").slider("value",100*this.value)})},D=function(e){return isNaN(e)||.05>e||e>99.99?!1:!0},F=function(){return $("#select_keyword_nav li.active a").attr("href").replace("#","")},O=function(){$("#textarea_prdtword").trigger("keyup"),$("#textarea_dcrtword").trigger("keyup"),$("#textarea_prmtword").trigger("keyup")},q=function(){$("#keyword_cart").removeClass("fixed").css({marginTop:0}),l=$("#keyword_selecter").outerHeight()+$("#keyword_selecter").offset().top-w,$(document).trigger("scroll")},E=function(){var e;e=$("#keyword_cart_box").offset().top,q(),$(document).off("scroll").on("scroll",function(){var t=document.body.scrollTop|document.documentElement.scrollTop;t>e?t>l?(l>0&&l>e&&$("#keyword_cart").removeClass("fixed").css({marginTop:l-e}),$("#keyword_cart .bottom_operation").css("position","absolute"),$("#keyword_selecter .bottom_operation").css("position","absolute")):(l>0&&$("#keyword_cart").addClass("fixed").css({marginTop:0}),$("#keyword_cart .bottom_operation").css("position","fixed"),$("#keyword_selecter .bottom_operation").css("position","fixed")):$("#keyword_cart").removeClass("fixed")}),$("#scroll_box").css("maxHeight",w-140),$("#keyword_cart_box").css("height",w),$("#keyword_cart .bottom_operation").css("visibility","visible"),$(document).trigger("scroll")},M=function(){var e=F(),t={adgroup_id:g,cat_id:v,select_type:e,max_add_num:x,auto_hide:0};switch(e){case"precise":t.word_filter=s;break;case"combine":t.prdtword_list=$.toJSON(u),t.dcrtword_list=$.toJSON(m),t.prmtword_list=$.toJSON(h);break;case"manual":t.manword_list=$.toJSON(p)}a.show("正在获取数据,请稍候..."),n.ajax("select_keyword",t,function(e){e.timestamp=(new Date).getTime(),I(e)})},I=function(e){var t=F();a.hide(),$("#"+t+"_box").removeClass("hidden"),R(e.data.filter_field_list),H(e.data.keyword_list,e.timestamp),T[t]=e,rt(),q()},J=function(){var e=(F(),Q().fnGetData()),t=[];for(var i in e)t.push([e[i][1].match(/mobile="0">(.*?)<\/span/)[1],Number(e[i][2]),-1==e[i][1].indexOf("del")?0:1]);a.show("正在获取数据,请稍候..."),n.ajax("mobile_package",{word_list:$.toJSON(t)},function(e){e.timestamp=(new Date).getTime(),U(e)})},U=function(e){var t=F();a.hide(),R(e.data.filter_field_list),H(e.data.keyword_list,e.timestamp),T[t+"Mobile"]=e},H=function(e,i){var n=[],a=0,o='<span class="hide custom"></span>^,^<div class="hide">{{r[0]}}</div><input type="checkbox" class="mr5" id="{{s}}input{{i}}"><span {{if r[9]}}class="del"{{/if}} data-price="{{r[7] | format:\'1,100,2\'}}" data-cpc="{{r[1] | format:\'1,100,2\'}}" data-sys="{{r[10]}}" data-roi="{{r[11][0]}}" data-imp="{{r[11][1]}}" data-hppr="{{r[11][2]}}" data-mobile="0">{{r[0]}}</span><a href="http://subway.simba.taobao.com/#!/tools/insight/queryresult?kws={{r[0]}}" target="_blank"><i class="iconfont link">&#xe64a;</i></a>^,^{{r[6]}}^,^{{r[1] | format:\'1,100,2\'}}^,^{{r[2]}}^,^{{r[3]}}^,^{{r[5]}}^,^{{r[4]}}%^,^{{r[8] | format:\'1,100,2\'}}%\n',r=F(),c=e.length;for(Z(),a;c>a;a++)n.push(t.compile(o)({r:e[a],i:String(a)+String(i),s:r}).split("^,^"));Q().fnClearTable(),Q().fnAddData(n)},z=function(t,i){for(var n=F(),a=[],o=Math.ceil(t/N),r=1;o>=r;r++)a.push(r);e(["jl6/site_media/widget/pageBar/pageBar"],function(e){var r=e.show({data:{record_count:t,page_xrange:a,page_count:o,page:i},onChange:function(e){Q().fnPageChange(e-1),q()}});$("#"+n+"_pagination").html(r)})},R=function(e){var i=F(),n=$("#"+i+"_div_sliders");n.empty(),L();for(var a=0;a<e.length;a++){var o=$.extend(!0,{},e[a]);if("keyword_score"==o.series_name||"cat_click"==o.series_name||"coverage"==o.series_name){var r=(o.current_to,o.limit);if(o.current_to=o.current_from,o.current_from=o.limit,o.limit=o.from,o.from=r,o.heterogeneity){for(var c=0;c<o.heterogeneity.length;c++){var s=o.heterogeneity[c].split("/");s.length&&(s[0]=100-Number(s[0]),o.heterogeneity[c]=s.join("/"))}o.heterogeneity=o.heterogeneity.reverse()}}else o.current_from=o.from;var l=t.compile('<div class="layout-slider">\n    <span class="series_name">{{cfg.series_name_cn}}</span>\n    <input id="{{selectType}}_{{cfg.series_name}}" type="slider" name="{{selectType}}{{cfg.series_name}}" value="{{cfg.current_from}};{{cfg.limit}}" data-from="{{cfg.from}}" data-to="{{cfg.limit}}"/>\n</div>\n')({cfg:o,selectType:i});n.append(l),o.svl[0]!=o.from?o.svl.unshift(o.from):1==o.svl.length&&o.svl.push(o.from+1),$("#"+i+"_"+o.series_name).slider("cat_cpc"==o.series_name||"coverage"==o.series_name?{round:2,step:.01,callback:P,from:o.from,to:o.limit,limits:!1,dimension:"",skin:"plastic",heterogeneity:o.heterogeneity||[]}:{step:1,callback:P,from:o.from,to:o.limit,limits:!1,dimension:"",skin:"plastic",heterogeneity:o.heterogeneity||[]})}G()},B=function(){var e=F();$("#"+e+"_div_sliders input").each(function(){var e=$(this).data();$(this).slider("value",e.from,e.to)}),$("#"+e+"_include").val("")},G=function(){var e=F();$("#"+e+" .dropdown-menu").removeClass("db vh")},L=function(){var e=F();$("#"+e+" .dropdown-menu").addClass("db vh")},P=function(){Z(),Q().fnFilter(""),q()},Z=function(){var e,t=F();j=[];for(var i=0;5>i;i++){var n=$("#"+t+"_div_sliders input")[i];n?(e=n.value.split(";"),j.push([Math.min(e[0],e[1]),Math.max(e[0],e[1])])):j.push([0,0])}j.push($.trim($("#"+t+"_include").val())),j.push($.trim($("#"+t+"_uninclude").val())),j.push($.trim($("#"+t).find(".filter.active").attr("data-type")))},A=function(){$("table[id*=_common_table]").each(function(){this.id.replace("_common_table","");$(this).dataTable({aoColumns:[{bSortable:!0,sType:"custom",sSortDataType:"custom-text",sClass:"hide"},{bSortable:!1},{bSortable:!0},{bSortable:!0},{bSortable:!0},{bSortable:!0},{bSortable:!0},{bSortable:!0,sType:"custom-percent"},{bSortable:!0,sType:"custom-percent"}],autoWidth:!1,bDestroy:!0,fnRowCallback:function(e,t){var i,n=t[1].match(/id="(.*?)"/)[1];i=document.getElementById("cart_tr_"+n),$("#"+n,e)[0].checked=i?!0:!1,$(e).addClass("check_column")},aaSorting:[[0,"desc"]],iDisplayLength:N,sDom:"",oLanguage:{sZeroRecords:"没有关键词记录"},fnDrawCallback:function(e){var t=F();e.aiDisplay.length?(z(e.aiDisplay.length,e._iDisplayStart/N+1),e.oInstance.find(".check_column").off(".shiftcheckbox").shiftcheckbox({checkboxSelector:"input",ignoreClick:"a",onChange:function(e){e?V.call(this):X.call(this)}}),e.oInstance.find(".check_column input").off("change").on("change",function(){this.checked?V.call($(this)):X.call($(this))}),$("#"+t).find(".bottom_operation").css("visibility","visible")):$("#"+t).find(".bottom_operation").css("visibility","hidden")}})})},W=function(){$.fn.dataTableExt.afnFiltering.push(function(e,t,i){if(!j.length)return!0;var n=[Number(t[2]),Number(t[8].replace("%","")),Number(t[6]),Number(t[5]),Number(t[3]),t[1].match(/<span.*>(.+?)<\/span>/i)[1],Number(t[0])],a=0;for(a;5>a;a++)if(n[a]<j[a][0]||n[a]>j[a][1])return!1;if(j[5]&&j[5]&&-1==n[5].toUpperCase().indexOf(j[5].toUpperCase()))return!1;if(j[6]&&j[6]&&-1!=n[5].toUpperCase().indexOf(j[6].toUpperCase()))return!1;if(j[7]&&"all"!=j[7]&&"mobile"!=j[7]){var o=Number(t[1].match(j[7]+'="(.*?)"')[1]);if(-1==o)return!1}return e.oInstance.fnGetNodes(i).childNodes[0].childNodes[0].innerText=-1!=["sys","all"].indexOf(j[7])?Number(t[2]):o,!0})},K=function(){return Q().fnSettings()},Q=function(){var e=F();return $("#"+e+"_common_table").dataTable()},V=function(){var e,i,n='<tr id="cart_tr_{{inputId}}">\n  <td class="check_column w20"><input type="checkbox" checked></td>\n  <td>\n    <span class="word">{{title}}</span><span class="iconfont f14 match ml5" data-match="4">&#xe623;</span>\n    <i class="iconfont r b del">&#xe614;</i>\n  </td>\n  <td class="pct20">\n    <input type="text" class="form-control price" maxlength="5" value="{{price | format:\'1,1,2\'}}" data-cpc="{{cpc}}" data-price="{{price}}">\n  </td>\n</tr>\n',a=this.attr("id");return $("#cart_tr_"+a).length?!1:(i=t.compile(n)({title:this.next().text(),price:this.next().data().price>=C?C:this.next().data().price<.05?.05:this.next().data().price,inputId:a,cpc:this.next().data().cpc}),e=$(i),$("#scroll_box table tbody").append(e),Y(),et(),void tt())},X=function(){var e;e=this.attr("id"),$("#cart_tr_"+e).remove(),Y(),et()},Y=function(){$(".total_num").text($("#scroll_box table>tbody>tr").length)},et=function(){$(".checked_num").text($("#scroll_box table>tbody>tr td.check_column input:checked").length),$("#keyword_cart .choose_all_column input")[0].checked=$("#scroll_box table>tbody>tr td.check_column input:checked").length&&$("#scroll_box table>tbody>tr td.check_column input:checked").length==$("#scroll_box table>tbody>tr td.check_column input").length?!0:!1},tt=function(){$("#scroll_box table>tbody>tr td.check_column input").off("shiftcheckbox").shiftcheckbox(),$("#scroll_box table>tbody>tr td.check_column input").off("change").on("change",function(){et()})},it=function(){var e=[];return $("#keyword_cart table tbody>tr td.check_column input:checked").each(function(){e.push($(this).parents("tr"))}),e},nt=function(e,t){var i=Number($("#custome_price").val()),n=Number($("#custome_price_multiple").val());for(var a in t){var o,r=t[a].find(".price");"sys"==e?o=Number(r.data().price).toFixed(2):"custom"==e&&D(i)?o=i.toFixed(2):"custom_multiple"==e&&(o=Number((r.data().cpc*n).toFixed(2))),.05>o&&(o=.05),o>C&&(o=C.toFixed(2)),o&&r.val(o)}},at=function(e,t){var i={1:"&#xe622;",2:"&#xe624;",4:"&#xe623;"};for(var n in t){var a=t[n].find(".match");a.html(i[e]).data("match",e)}},ot=function(){var e="";return $(K().aoData).each(function(){e+=this.nTr.childNodes[1].childNodes[0].innerText+"\n"}),e},rt=function(){$(".FixedHeader_Cloned").remove(),K().aoData.length&&(d=new FixedHeader(Q()))};return{init:function(){E(),S(),W(),A(),"quick"===k&&$("#select_keyword_nav>li>a[href=#quick]").trigger("shown.bs.tab"),"combine"===k&&O(),c.init()}}});