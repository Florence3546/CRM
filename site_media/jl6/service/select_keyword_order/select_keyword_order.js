define("jl6/site_media/service/select_keyword_order/select_keyword_order",["require","jl6/site_media/service/common/common","jl6/site_media/plugins/data-tables/dataTableExt","jl6/site_media/plugins/caret/jquery.caret.min","jl6/site_media/plugins/jquery-tag-editor/jquery.tag-editor.min","jl6/site_media/widget/alert/alert","jl6/site_media/widget/confirm/confirm","jl6/site_media/plugins/shiftcheckbox/jquery.shiftcheckbox","jl6/site_media/plugins/zclip/jquery.zclip.min","jl6/site_media/plugins/jslider/js/jquery.slider","jl6/site_media/widget/lightMsg/lightMsg","jl6/site_media/widget/ajax/ajax","jl6/site_media/widget/loading/loading","jl6/site_media/plugins/artTemplate/template","jl6/site_media/widget/templateExt/templateExt","jl6/site_media/service/select_feedback/select_feedback"],function(e,t,i,a,s,n,l,r,o,c,d,u,_,f,m,p){"use strict";var h,v,g,b={},y=100,w=[],k=function(){v.fnClearTable(),$("#div_core_keyword").addClass("hidden"),$("#alert_info, #keyword_selecter").addClass("vh"),$("#div_item_info").addClass("vh").empty(),$("#filter_group [data-type=all]").addClass("active").siblings().removeClass("active")},C=function(e){var t,i;t='<div class="head">\n    <a class="arrow" href="javascript:;">\n	    <i class="iconfont down">&#xe603;</i>\n	    <i class="iconfont up">&#xe616;</i>\n    </a>\n    <span id="item_title">{{title}}</span>\n    <span class="price">￥{{item_price}} 元</span>\n    <input type="hidden" id="nick" value="{{nick}}"/>\n</div>\n<div class="body">\n    <div class="abs">\n	    <img class="l m20" src="{{pic_url}}" height="200"/>\n	    <div class="l mt20 gray" style="width: 1000px;">\n	        <p class="mb20">所属类目：<span id="cat_info" cat_id="{{cat_id}}">{{cat_path}}</span></p>\n	        <ul id="ul_item_info">\n	            {{each property_list}}\n	            <li title="{{$value}}">{{$value | truncate:\'30\'}}</li>\n	            {{/each}}\n	        </ul>\n	    </div>\n    </div>\n</div>',i=f.compile(t)(e),$("#div_item_info").removeClass("vh").html(i)},x=function(e){$("#alert_info, #keyword_selecter").removeClass("vh"),v.fnClearTable(),v.fnAddData(e),F(),U(),v.fnFilter(""),$(".keyword_count").html(v.fnSettings().aiDisplay.length)},j=function(e){return $.map(e,function(e){return[["",'<input type="checkbox" name="keyword" value="'+e[0]+'" data-sys="'+e[10]+'" data-roi="'+e[11][0]+'" data-imp="'+e[11][1]+'" data-hppr="'+e[11][2]+'">',e[0]+'<a href="http://subway.simba.taobao.com/#!/tools/insight/queryresult?kws='+e[0]+'" target="_blank"><i class="iconfont link">&#xe64a;</i></a>',e[6],(e[1]/100).toFixed(2),e[2],e[3],e[5],e[4].toFixed(2)+"%",(e[8]/100).toFixed(2)+"%"]]})},T=function(e){_.show("数据加载中，请稍候..."),u.ajax("select_keyword_order",e,function(e){if(e.data.item_info&&(C(e.data.item_info),$("#div_core_keyword").hasClass("hidden")||g.build_select_box(e.data.item_info.elemword_dict)),e.data.filter_field_list&&E(e.data.filter_field_list),e.data.keyword_list){var t=j(e.data.keyword_list);b={pc:t,pc_filter:e.data.filter_field_list},x(t)}_.hide()},null,{url:"/toolkit/ajax/"})},D=function(e){_.show("数据加载中，请稍候...");var e=$.map(v.fnSettings().aoData,function(e){return[[e._aData[2].match("(.*)<a")[1],e._aData[3],0]]});u.ajax("mobile_package",{word_list:JSON.stringify(e)},function(e){var t=j(e.data.keyword_list);b.mobile=t,b.mobile_filter=e.data.filter_field_list,E(e.data.filter_field_list),x(t),_.hide()},null,{url:"/toolkit/ajax/"})},S=function(t,i){var a=[],s=Math.ceil(t/y);$("#pagination_info").html("每页显示"+y+"个关键词　共"+s+"页");for(var n=1;s>=n;n++)a.push(n);e(["jl6/site_media/widget/pageBar/pageBar"],function(e){var n=e.show({data:{record_count:t,page_xrange:a,page_count:s,page:i,binfo:!1},onChange:function(e){v.fnPageChange(e-1)}});$("#pagination_bar").html(n)})},q=function(e){v=$(e).dataTable({aoColumns:[{bSortable:!0,sType:"custom",sSortDataType:"custom-text",sClass:"hidden"},{bSortable:!1,sClass:"hidden"},{bSortable:!0},{bSortable:!0},{bSortable:!0},{bSortable:!0},{bSortable:!0},{bSortable:!0},{bSortable:!0,sType:"custom-percent"},{bSortable:!0,sType:"custom-percent"}],bLengthChange:!1,bDestroy:!0,iDisplayLength:y,sDom:"",oLanguage:{sZeroRecords:"没有关键词记录"},fnDrawCallback:function(e){e.aiDisplay.length?(S(e.aiDisplay.length,e._iDisplayStart/y+1),$("#keyword_selecter .bottom").css("visibility","visible")):$("#keyword_selecter .bottom").css("visibility","hidden")},aaSorting:[[0,"desc"]]})},N=function(){$.fn.dataTableExt.afnFiltering.push(function(e,t,i){if(!w.length)return!0;var a=[Number(t[3]),Number(t[9].replace("%","")),Number(t[7]),Number(t[6]),Number(t[4]),t[2].match("(.*)<a")[1],Number(t[0])],s=0;for(s;5>s;s++)if(a[s]<w[s][0]||a[s]>w[s][1])return!1;if(w[5]&&w[5]&&-1==a[5].toUpperCase().indexOf(w[5].toUpperCase()))return!1;if(w[6]&&w[6]&&-1!=a[5].toUpperCase().indexOf(w[6].toUpperCase()))return!1;if(w[6]&&"all"!=w[6]&&"mobile"!=w[6]){var n=Number(t[1].match(w[6]+'="(.*?)"')[1]);if(-1==n)return!1}return e.oInstance.fnGetNodes(i).childNodes[0].innerText=-1!=["sys","all"].indexOf(w[6])?Number(t[3]):n,!0})},E=function(e){var t=$("#filter_sliders");t.empty(),$("#keyword_selecter .dropdown-menu").addClass("db vh");for(var i=0;i<e.length;i++){var a=$.extend(!0,{},e[i]);if("keyword_score"==a.series_name||"cat_click"==a.series_name||"coverage"==a.series_name){var s=(a.current_to,a.limit);if(a.current_to=a.current_from,a.current_from=a.limit,a.limit=a.from,a.from=s,a.heterogeneity){for(var n=0;n<a.heterogeneity.length;n++){var l=a.heterogeneity[n].split("/");l.length&&(l[0]=100-Number(l[0]),a.heterogeneity[n]=l.join("/"))}a.heterogeneity=a.heterogeneity.reverse()}}else a.current_from=a.from;var r=f.compile('<div class="layout-slider">\n    <span class="series_name">{{cfg.series_name_cn}}</span>\n    <input id="{{selectType}}_{{cfg.series_name}}" type="slider" name="{{selectType}}{{cfg.series_name}}" value="{{cfg.current_from}};{{cfg.limit}}" data-from="{{cfg.from}}" data-to="{{cfg.limit}}"/>\n</div>\n')({cfg:a,selectType:""});t.append(r),a.svl[0]!=a.from?a.svl.unshift(a.from):1==a.svl.length&&a.svl.push(a.from+1),$("#_"+a.series_name).slider("cat_cpc"==a.series_name||"coverage"==a.series_name?{round:2,step:.01,callback:M,from:a.from,to:a.limit,limits:!1,dimension:"",skin:"plastic",heterogeneity:a.heterogeneity||[]}:{step:1,callback:M,from:a.from,to:a.limit,limits:!1,dimension:"",skin:"plastic",heterogeneity:a.heterogeneity||[]})}$("#keyword_selecter .dropdown-menu").removeClass("db vh")},F=function(){$("#filter_sliders input").each(function(){var e=$(this).data();$(this).slider("value",e.from,e.to)}),$("#filter_include").val("")},M=function(){U(),v.fnFilter(""),$(".keyword_count").html(v.fnSettings().aiDisplay.length)},U=function(){var e;w=[];for(var t=0;5>t;t++){var i=$("#filter_sliders input")[t];i?(e=i.value.split(";"),w.push([Math.min(e[0],e[1]),Math.max(e[0],e[1])])):w.push([0,0])}w.push($.trim($("#filter_include").val())),w.push($.trim($("#filter_uninclude").val())),w.push($.trim($("#filter_group .filter.active").attr("data-type")))},z=function(e){g=function(e){var t={placeholder:"输入核心词",onChange:function(e,t,i){$("#select_box ul.pt-tag>li").removeClass("select");var a="";for(var s in i)a+=i[s],$("#select_box a[value="+i[s]+"]").parent("li").addClass("select")}};return e.tagEditor(t),{get_word_list:function(){return e.tagEditor("getTags")[0].tags},clear:function(){e.text("");var t=g.get_word_list();for(var i in t)e.tagEditor("removeTag",t[i]);$("#div_core_keyword>ul.tag-editor").focusout(),$("#select_box .pt-tag>li").removeClass("select")},addTag:function(t){e.tagEditor("addTag",t)},removeTag:function(t){e.tagEditor("removeTag",t)},build_select_box:function(e){g.clear();var t,i;t='<div class="p10">\n    <div class="mt10" id="div_prdtword">\n        <strong class="l lh25">产品词：</strong>\n        <ul class="pt-tag">\n            {{if prdtword_list}}\n            {{each prdtword_list}}\n            <li><a value="{{$value}}" name="prdtword" href="javascript:;">{{$value}}</a></li>\n            {{/each}}\n            {{else}}\n            <li><span class="lh25">暂无数据</span></li>\n            {{/if}}\n        </ul>\n    </div>\n    <div class="mt10" id="div_propword">\n        <strong class="l lh25">属性词：</strong>\n        <ul class="pt-tag">\n            {{if dcrtword_list}}\n            {{each dcrtword_list}}\n            <li><a value="{{$value}}" name="propword" href="javascript:;">{{$value}}</a></li>\n            {{/each}}\n            {{else}}\n            <li><span class="lh25">暂无数据</span></li>\n            {{/if}}\n        </ul>\n    </div>\n</div>',i=f.compile(t)(e),$("#select_box").html(i)}}}($(e))},O=function(){$("#select_box").height($("#select_box>div").outerHeight()),$("#div_core_keyword>ul.tag-editor").addClass("focus")},L=function(){$("#select_box").height(0),$("#div_core_keyword>ul.tag-editor").removeClass("focus")},B=function(){$("#div_core_keyword>ul.tag-editor").focusin(function(){O()}),$(document).click(function(e){0==$(e.target).closest("#div_core_keyword").length&&L()}),$("#select_box").on("click",".pt-tag>li",function(){$(this).hasClass("select")?($(this).removeClass("select"),g.removeTag($(this).text())):g.get_word_list().length<3?($(this).addClass("select"),g.addTag($(this).text())):d.show("最多只能选择3个核心词")})},I=function(){var e=v.fnSettings(),t=$.map(e.aiDisplay,function(t){return e.aoData[t]._aData[2].match("(.*)<a")[1]});return t.join("\n")},R=function(){$("#btn_quick_select, #btn_precise_tao").click(function(){if(k(),$("#top_advs div:eq(0)").addClass("inactive"),$("#top_advs div:eq(1)").removeClass("inactive"),h=$.trim($("#item_url").val())){var e={item_url:h};switch(this.id){case"btn_quick_select":$.extend(e,{select_type:"quick",mode:"precise"}),$("#mode_switch").show();break;case"btn_precise_tao":$.extend(e,{select_type:"precise"}),$("#div_core_keyword").removeClass("hidden"),$("#mode_switch").hide()}T(e)}else n.show("请先输入宝贝链接")}),$("#btn_precise_tao2").click(function(){var e=g.get_word_list();0==e.length?n.show("请先输入核心词"):(L(),T({item_url:h,select_type:"precise",word_filter:e.join(" ")}))}),$("#div_item_info").on("click","a.arrow",function(){$("#div_item_info").toggleClass("up")}),$("#mode_switch button").click(function(){$(this).hasClass("active")||($(this).addClass("active btn-primary").removeClass("btn-default"),$(this).siblings().removeClass("active btn-primary").addClass("btn-default"),$("#filter_group [data-type=all]").addClass("active").siblings().removeClass("active"),T({item_url:h,select_type:"quick",mode:$(this).data("mode")}))}),$("#filter_group .filter").click(function(){$(this).hasClass("active")||$(this).addClass("active").siblings().removeClass("active"),"mobile"==$(this).data("type")?b.mobile?(E(b.mobile_filter),x(b.mobile)):D():(E(b.pc_filter),x(b.pc),v.fnSort([[0,"desc"]]))}),$(".btn_search").on("click",function(){M()}),$("#copy_btn").zclip({path:"/site_media/jl6/plugins/zclip/ZeroClipboard.swf",copy:function(){return I()},afterCopy:function(){d.show("已复制成功，赶紧分享给你的小伙伴吧！")}}),$("#export_btn").click(function(){var e=v.fnSettings(),t=$.map(e.aiDisplay,function(t){var i=e.aoData[t]._aData.slice(2);return i[0]=i[0].match("(.*)<a")[1],i.join(",")});this.href="data:text/csv;charset=utf-8,﻿"+encodeURIComponent("关键词,匹配度,市场均价,展现指数,点击指数,竞争指数,市场点击率,市场转化率\n"+t.join("\n"))})};return{init:function(){N(),q("#table_select_keyword"),z("#core_keyword"),B(),p.init(),R()}}});