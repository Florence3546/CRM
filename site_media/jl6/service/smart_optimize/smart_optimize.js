define("jl6/site_media/service/smart_optimize/smart_optimize",["require","jl6/site_media/service/common/top_bar_event","jl6/site_media/service/common/common","jl6/site_media/plugins/artTemplate/template","jl6/site_media/service/keyword/keyword","jl6/site_media/plugins/moment/moment.min","jl6/site_media/plugins/jslider/js/jquery.slider","jl6/site_media/plugins/jquery-pin/jquery.pin.min"],function(t,e,a,s,n,c){"use strict";var d,i,l,r,o=c().subtract(7,"days").format("YYYY-MM-DD"),p=c().subtract(1,"days").format("YYYY-MM-DD"),_="default",u=function(){d=$("#campaign_id").val(),i=$("#adgroup_id").val(),l=$("#item_id").val()},v=function(){a.loading.show("正在获取数据,请稍候..."),a.sendAjax.ajax("adgroup_optimize",{adgroup_id:i,campaign_id:d,start_date:o,end_date:p,stgy:_,source:$("#data_source button.active").data().source},f)},m=function(){$("#select_keyword_days").on("change",function(){o=c($(this).daterangepicker("getRange").start).format("YYYY-MM-DD"),p=c($(this).daterangepicker("getRange").end).format("YYYY-MM-DD"),v()}),$("#data_source button").on("click",function(){$("#data_source button.active").removeClass("active btn-primary").addClass("btn-default"),$(this).addClass("active btn-primary"),v()}),$("#set_percent input").slider({from:30,to:300,skin:"power",callback:function(t){for(var e in r.rowCache){var a,s,n=r.rowCache[e];s=(n.data.new_price-n.maxPrice)*t/100,s>0&&.01>s?s=.01:0>s&&s>-.01&&(s=-.01),a=(s+n.maxPrice).toFixed(2),.05>a&&(a=.05),a>99.99&&(a=99.99),n.newPriceInput.val(a),n.updateStyle()}for(var e in r.rowCache){var a,s,n=r.rowCache[e];s=(n.data.new_mobile_price-n.maxMobilePrice)*t/100,s>0&&.01>s?s=.01:0>s&&s>-.01&&(s=-.01),a=(s+n.maxMobilePrice).toFixed(2),.05>a&&(a=.05),a>99.99&&(a=99.99),n.newMobilePriceInput.val(a),n.updateStyle()}}}),$("#smart_optimize_select").on("change",function(t,e){_=e,v()})},f=function(t){a.loading.hide();var e,c='{{if keywordList.length}}\n<tr class="unsort">\n    <td></td>\n    <td class="hide"></td>\n    <td>\n        <div class="input-group custom_search">\n            <span class="select_warp btn-group" id="search_type">\n                <button type="button" class="tip btn btn-default" data-toggle="dropdown">模糊</button>\n                <ul class="dropdown-menu">\n                    <li data-value="0"><span>模糊</span></li>\n                    <li data-value="1"><span>精准</span></li>\n                </ul>\n            </span>\n            <input type="text" class="form-control search_val" placeholder="输入关键词">\n            <span class="input-group-btn search_btn">\n                <button class="btn btn-default" type="button"><i class="iconfont f16">&#xe618;</i></button>\n            </span>\n        </div>\n    </td>\n    <td></td>\n    <td>\n        <button class="btn btn-xs btn-default" id="recovery_all">全部重置</button>\n    </td>\n    <td></td>\n    <td>\n        <button class="btn btn-xs btn-default" id="recovery_mobile_all">全部重置</button>\n    </td>\n    <td>\n        <span id="rank_time">--:--</span>排名&emsp;<button class="btn btn-xs btn-default" id="rank_all">立即更新</button>\n    </td>\n    <td>--</td>\n    <td>\n        <span class="b">定向</span>\n    </td>\n    <td>--</td>\n    <td class="striped">{{adg_nosch.impr}}</td>\n    <td class="striped">{{adg_nosch.click}}</td>\n    <td class="striped">{{adg_nosch.ctr}}%</td>\n    <td class="striped">{{adg_nosch.cost}}</td>\n    <td class="striped">{{adg_nosch.cpc}}</td>\n    <td class="striped">{{adg_nosch.cpm}}</td>\n    <td class="striped">--</td>\n    <td>{{adg_nosch.favcount}}</td>\n    <td>{{adg_nosch.favshopcount}}</td>\n    <td>{{adg_nosch.favitemcount}}</td>\n    <td>{{adg_nosch.favctr}}%</td>\n    <td>{{adg_nosch.favpay}}</td>\n    <td>{{adg_nosch.carttotal}}</td>\n    <td>{{adg_nosch.paycount}}</td>\n    <td>{{adg_nosch.directpaycount}}</td>\n    <td>{{adg_nosch.indirectpaycount}}</td>\n    <td>{{adg_nosch.pay}}</td>\n    <td>{{adg_nosch.directpay}}</td>\n    <td>{{adg_nosch.indirectpay}}</td>\n    <td>{{adg_nosch.conv}}%</td>\n    <td>{{adg_nosch.roi}}</td>\n    <td class="striped">--</td>\n    <td class="striped">--</td>\n    <td class="striped">--</td>\n    <td class="striped">--</td>\n    <td class="striped">--</td>\n    <td class="striped">--</td>\n    <td class="striped">--</td>\n    <td class="striped">--</td>\n</tr>\n{{each keywordList}}\n<tr id="{{$value.keyword_id}}" data-adgroup_id="{{$value.adgroup_id}}" data-campaign_id="{{$value.campaign_id}}" data-label-code="{{$value.label_code}}" data-tree-code="{{$value.tree_code}}" data-roi="{{$value.roi}}" data-g_cpc="{{$value.g_cpc | format:\'1,100,2\'}}" data-cpc="{{$value.cpc}}"\n    data-ctr="{{$value.ctr}}" data-click="{{$value.click}}" data-qscore="{{$value.qscore_dict.qscore}}" data-wireless_qscore="{{$value.qscore_dict.wireless_qscore}}" data-max_price="{{$value.max_price}}" data-max_mobile_price="{{$value.max_mobile_price}}" data-g_click="{{$value.g_click}}" data-match="{{$value.match_scope}}"\n    data-mnt="{{$value.mnt_opt_type}}" data-new_price="{{$value.new_price}}" data-new_mobile_price="{{$value.new_mobile_price}}" data-optm_type="{{$value.optm_type}}" data-locked="{{$value.is_locked}}">\n    <td class="check_column">\n        <input type="checkbox">\n    </td>\n    <td class="hide">\n        <span class="hide main_sort">{{if $value.optm_type=="1" }}3{{/if}}{{if $value.new_price>$value.max_price }}2{{/if}}{{if $value.max_price>$value.new_price }}1{{/if}}{{if $value.max_price==$value.new_price }}0{{/if}}</span>\n    </td>\n    <td>\n        <a target="_blank" class="word" href="http://subway.simba.taobao.com/#!/tools/insight/queryresult?kws={{$value.word}}">\n                {{$value.word}}\n            </a> {{if $value.qscore_dict.wireless_matchflag == "2"}}\n        <span class="iconfont" data-toggle="tooltip" data-placement="right" data-trigger="hover" title="移动首屏展示机会:机会在手机淘宝网和淘宝客户端搜索结果中屏展示">&#xe625;</span> {{/if}} {{if $value.qscore_dict.wireless_matchflag == "4"}}\n        <span class="iconfont" data-toggle="tooltip" data-placement="right" data-trigger="hover" title="移动首屏展示机会:有机会在手机淘宝网和淘宝客户端搜索结果第一屏展示">&#xe625;</span> {{/if}} {{if $value.qscore_dict.pc_left_flag}}\n        <span class="iconfont" data-toggle="tooltip" data-placement="right" data-trigger="hover" title="淘宝豆腐块展示机会:有机会在淘宝搜索关键词结果页左侧展示">&#xe626;</span> {{/if}}\n        <i class="iconfont del">&#xe614;</i>\n        <i class="iconfont match">\n                {{if $value.match_scope == 4 || $value.match_scope == 2 }}\n                &#xe623;\n                {{/if}}\n                {{if $value.match_scope == 1 }}\n                &#xe622;\n                {{/if}}\n            </i> {{if set_mnt_flag }}\n\n        <i class="iconfont mnt">\n                {{if $value.mnt_opt_type == 1}}\n                &#xe654;\n                {{/if}}\n                {{if $value.mnt_opt_type == 2}}\n                &#xe655;\n                {{/if}}\n                {{if $value.mnt_opt_type == 0}}\n                &#xe653;\n                {{/if}}\n            </i> {{/if}}\n\n        <i class="iconfont chart">&#xe60c;</i>\n    </td>\n    <td class="max_price sort_custom"><span class="hide">{{$value.max_price}}</span>{{if $value.is_default_price}}<span class="tag tag-gary">默</span>{{/if}}{{$value.max_price}}</td>\n    <td>\n        <input type="text" maxlength="5" class="w40 new_price" value="{{if userNewPrice}}{{$value.new_price}}{{else}}{{$value.max_price}}{{/if}}">\n        <i class="iconfont recovery">&#xe621;</i>\n    </td>\n    <td class="max_mobile_price sort_custom"><span class="hide">{{$value.max_mobile_price}}</span>{{if $value.mobile_is_default_price}}<span class="tag tag-gary">折</span>{{/if}}{{$value.max_mobile_price}}</td>\n    <td>\n        <input type="text" maxlength="5" class="w40 new_mobile_price" value="{{if userNewPrice}}{{$value.new_mobile_price}}{{else}}{{$value.max_mobile_price}}{{/if}}">\n        <i class="iconfont recovery_mobile">&#xe621;</i>\n    </td>\n    <td class="sort_custom">\n        <span class="hide">0</span>\n        <div class="rank">\n            <span class="pc_rank_desc db pct50 l">--</span>\n            <span class="hide pc_rank"></span>\n            <span class="left_dotted db pct50 l mobile_rank_desc">--</span>\n            <span class="hide mobile_rank"></span>\n        </div>\n    </td>\n    <td class="rob_rank">\n        {{if $value.is_locked}}\n        <a href="javascript:;" class="rob_record">已设为自动</a><a href="javascript:;" class="rob_set ml5">设置</a> {{else}}\n        <a href="javascript:;" class="rob">抢</a> {{/if}}\n    </td>\n    <td class="qscore sort_custom" pc_qscore="{{$value.qscore_dict.qscore}}" pc_creative_score="{{$value.qscore_dict.creativescore}}" pc_rele_score="{{$value.qscore_dict.kwscore}}" pc_cvr_score="{{$value.qscore_dict.cvrscore}}" yd_qscore="{{$value.qscore_dict.wireless_qscore}}"\n        yd_creative_score="{{$value.qscore_dict.wireless_creativescore}}" yd_rele_score="{{$value.qscore_dict.wireless_relescore}}" yd_cvr_score="{{$value.qscore_dict.wireless_cvrscore}}" matchflag="{{$value.qscore_dict.wireless_matchflag}}" plflag="{{$value.qscore_dict.pc_left_flag}}">\n        <span class="hide">0</span>\n        <span class="pc_qs db pct50 l">{{$value.qscore_dict.qscore}}</span><span class="mobile_qs left_dotted db pct50 l">{{if $value.qscore_dict.wireless_qscore >-1 }}{{$value.qscore_dict.wireless_qscore}}{{else}}--{{/if}}\n            </span>\n\n    </td>\n    <td>{{$value.create_days}}</td>\n    <td class="striped">{{$value.impr}}</td>\n    <td class="striped">{{$value.click}}</td>\n    <td class="striped">{{$value.ctr}}%</td>\n    <td class="striped">{{$value.cost}}</td>\n    <td class="striped">{{$value.cpc}}</td>\n    <td class="striped">{{$value.cpm}}</td>\n    <td class="striped">{{$value.avgpos}}</td>\n    <td>{{$value.favcount}}</td>\n    <td>{{$value.favshopcount}}</td>\n    <td>{{$value.favitemcount}}</td>\n    <td>{{$value.favctr}}%</td>\n    <td>{{$value.favpay}}</td>\n    <td>{{$value.carttotal}}</td>\n    <td>{{$value.paycount}}</td>\n    <td>{{$value.directpaycount}}</td>\n    <td>{{$value.indirectpaycount}}</td>\n    <td>{{$value.pay}}</td>\n    <td>{{$value.directpay}}</td>\n    <td>{{$value.indirectpay}}</td>\n    <td>{{$value.conv}}%</td>\n    <td {{if $value.roi>1}}class="red"{{/if}}>{{$value.roi}}</td>\n    <td class="striped">{{$value.g_pv}}</td>\n    <td class="striped">{{$value.g_click}}</td>\n    <td class="striped">{{$value.g_ctr}}%</td>\n    <td class="striped">{{$value.g_coverage}}%</td>\n    <td class="striped">{{$value.g_roi}}</td>\n    <td class="striped">{{$value.g_cpc | format:\'1,100,2\'}}</td>\n    <td class="striped">{{$value.g_competition}}</td>\n    <td class="striped">{{$value.g_paycount}}</td>\n</tr>\n{{/each}} {{/if}}\n';e=s.compile(c)({keywordList:t.keyword_list,adg_nosch:t.nosearch_rpt,set_mnt_flag:t.set_mnt_flag,userNewPrice:!0,adgroup_id:i}),r&&r.table.fnDestroy(),$("#keyword_table tbody").html(e),r=new n.Table({element:$("#keyword_table"),hideColumn:t.custom_column,warnPrice:Number($("#warn_price input").val()),mobileWarnPrice:Number($("#mobile_warn_price input").val()),headerMarginTop:50,layoutCallback:function(){for(var t in this.rowCache)1==this.rowCache[t].data.optm_type&&(this.rowCache[t].del=!0),this.rowCache[t].updateStyle(),this.rowCache[t].checkboxInput[0].checked=this.rowCache[t].up||this.rowCache[t].down||this.rowCache[t].del?!0:!1;this.calcChangeNum(),this.checkCallback(),$('[data-toggle="tooltip"]').tooltip({html:!0})}}),r.generateCsvData(t.keyword_list),$(".operate").pin({containerSelector:".box",padding:{bottom:-40}})};return{init:function(){e.adgMain(),u(),i&&(v(15),m())}}});