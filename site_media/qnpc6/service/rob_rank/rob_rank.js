define("site_media/service/rob_rank/rob_rank",["site_media/plugins/artTemplate/template","site_media/plugins/jslider/js/jquery.slider","site_media/widget/jqueryExt/serializeObject","site_media/widget/ajax/ajax","site_media/service/rob_rank/real_time"],function(e,n,a,t,i){"use strict";var r,s,d,l='<div style="width: 600px; margin-left: -300px; left:50%;" tabindex="-1" role="dialog" data-hasfoot="false" class="sui-modal hide fade" id="rob_rank">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h4>"{{word}}"抢排名设置</h4>\n            </div>\n            <div class="modal-body" style="overflow: initial">\n                <form class="sui-form" style="margin-top:10px;">\n                    <div>\n                        抢位方式：\n                        <input type="radio" name="method" value="manual" {{if method=="manual"}}checked{{/if}}>手动&emsp;\n                        <input type="radio" name="method" value="auto" {{if method=="auto"}}checked{{/if}} style="margin-left: 30px;">自动\n                        <span class="text-muted ml20 manual_info hide">(手动抢排名时，请不要刷新界面)</span>\n                        <div class="slider" style="width: 200px;margin-left: 20px;vertical-align: 2px; display: none">\n                            <input type="text" value="{{if start_time!=undefined }}{{start_time}}{{else}}480{{/if}};{{if end_time!=undefined }}{{end_time}}{{else}}1024{{/if}}">\n                        </div>\n                    </div>\n                    <div class="mt15">\n                        抢位平台：\n                        <input type="radio" name="platform" value="pc" {{if platform=="pc"}}checked{{/if}}/>计算机\n                        <span class="ml20">\n                          （当前出价：{{maxPrice}}元，{{qscore}}分，<span class="pc_rank">{{pc_rank_desc}}</span>）\n                        </span>\n                    </div>\n                    <div class="mt15">\n                        抢位平台：\n                        <input type="radio" name="platform" value="yd" {{if platform=="yd"}}checked{{/if}}/>移动\n                          <span class="ml20">\n                              （当前出价：{{maxMobilePrice}}元，{{if wirelessQscore>0 }}{{wirelessQscore}}分{{/if}}，<span class="yd_rank">{{ydRank}}</span>）\n                          </span>\n                    </div>\n                    <div class="mt15">\n                        期望排名：\n                        <span class="sui-dropdown dropdown-bordered select">\n                            <span class="dropdown-inner">\n                                <a role="button" data-toggle="dropdown" href="javascript:void(0);" class="dropdown-toggle">\n                                    <input value="{{rank_start}}" id="rank_start" name="rank_start" type="hidden" class="rank_value"><span class="rank_name">{{rank_start_name}}</span><i class="iconfont fr">&#xe603;</i>\n                                </a>\n                                <ul role="menu" aria-labelledby="drop1" class="sui-dropdown-menu rank_item_start">\n                                </ul>\n                            </span>\n                        </span>&ensp;至&ensp;\n                            <span class="sui-dropdown dropdown-bordered select">\n                            <span class="dropdown-inner">\n                                <a role="button" data-toggle="dropdown" href="javascript:void(0);" class="dropdown-toggle">\n                                    <input value="{{rank_end}}"  id="rank_end" name="rank_end" type="hidden" class="rank_value"><span class="rank_name">{{rank_end_name}}</span><i class="iconfont fr">&#xe603;</i>\n                                </a>\n                                <ul role="menu" aria-labelledby="drop1" class="sui-dropdown-menu rank_item_end">\n                                </ul>\n                            </span>\n                        </span>\n                        <!--<input type="text" autocomplete="off" name="rank_start" maxlength="3" class="input-mini" value="{{rank_start}}">\n                        <input type="text" autocomplete="off" name="rank_end" maxlength="3" class="input-mini" value="{{rank_end}}">&ensp;名-->\n                    </div>\n                    <div class="mt15">\n                        最高限价：\n                        <input type="text" autocomplete="off" maxlength="5" name="limit" class="input-mini" value="{{limit}}">&ensp;元\n                    </div>\n                    <div class="mt15">\n                        抢位失败：\n                        <input type="radio" name="nearly_success" {{if nearly_success=="1"|| nearly_success == undefined }}checked{{/if}} value="1">接近期望排名时保留出价\n                        <input type="radio" name="nearly_success" {{if nearly_success=="0"}}checked{{/if}} value="0" style="margin-left: 20px;">恢复为原价\n                    </div>\n                </form>\n                <div class="red mt15">免责声明：抢位可能导致花费过高，如因抢排名导致效果不佳，与精灵无关</div>\n            </div>\n            <div class="modal-footer">\n                <button type="button" class="sui-btn btn-bordered btn-xlarge btn-primary" data-dismiss="modal">取消</button>\n                {{if method == "auto"}}\n                    <button type="button" class="sui-btn btn-bordered btn-xlarge btn-primary rob_cancle">取消自动抢</button>\n                {{/if}}\n                <button type="button" class="sui-btn btn-xlarge btn-primary submit">确定</button>\n            </div>\n        </div>\n    </div>\n</div>\n',o='{{each list}}\r\n<li role="presentation"><a role="menuitem" value="{{$value.id}}" tabindex="-1" href="#">{{$value.name}}</a></li>\r\n{{/each}}',m=function(n){var a,t;n.start_time&&isNaN(n.start_time)&&(n.start_time=k(n.start_time)),n.end_time&&isNaN(n.end_time)&&(n.end_time=k(n.end_time)),a=e.compile(l)(n),t=$(a),$("body").append(t),t.modal({backdrop:"static",keyboard:!1}),c(n.platform,n.rank_start_desc_map),p(n.platform,n.rank_end_desc_map),u(t,n),t.modal("show"),t.on("hidden.bs.modal",function(){_(t,n)}),$("#"+n.keywordId).trigger("get.rank",[function(e){n.keyword_id in e.data?(t.find(".pc_rank").text(e.data[n.keyword_id].pc_rank_desc),t.find(".yd_rank").text(e.data[n.keyword_id].mobile_rank_desc).show()):(t.find(".pc_rank").text("获取失败"),t.find(".yd_rank").text("获取失败")),e.data[n.keyword_id].mobile_rank_desc.indexOf("未投放")>=0&&($("input[value=pc]").find("input[value=pc]").attr("checked"),$("input[value=yd]").attr("disabled",!0))}]),$(".rank_item_start li").each(function(){var e=$(this).find("a").attr("value");e==$("#rank_start").val()?$(this).addClass("active"):$(this).removeClass("active")}),$(".rank_item_end li").each(function(){var e=$(this).find("a").attr("value");e==$("#rank_end").val()?$(this).addClass("active"):$(this).removeClass("active")})},c=function(n,a){var t=[];d=a[n];for(var i in d)t.push({id:i,name:d[i]});s=e.compile(o)({list:t}),$(".rank_item_start").html(s)},p=function(n,a){var t=[];d=a[n];for(var i in d)t.push({id:i,name:d[i]});s=e.compile(o)({list:t}),$(".rank_item_end").html(s)},u=function(e,n){var a=e;$(a).find(".slider input").slider({skin:"plastic",from:0,to:1440,step:60,calculate:function(e){return f(e)}}),$(a).find(".slider").removeClass("vh").addClass("hide"),$(a).find("input[name=method]").on("change",function(){var e=$(a).find(".manual_info"),n=$(a).find(".slider");"auto"==this.value?(n.css("display","inline-block"),e.addClass("hide")):(n.css("display","none"),e.removeClass("hide"))}),n.method&&$(a).find("input[name=method]").trigger("change"),$(a).on("change","input[name=platform]",function(){$(".platform_info",a).addClass("hide"),"pc"==this.value&&n.qscore<=5&&$(".platform_info",a).removeClass("hide").find("span").text("PC端"),"yd"==this.value&&n.wirelessQscore<=5&&$(".platform_info",a).removeClass("hide").find("span").text("移动端"),c(this.value,n.rank_start_desc_map),p(this.value,n.rank_end_desc_map),$(".rank_value").val("-3"),$(".rank_name").text("请选择...")}),$(a).on("click",".submit",function(){var e,i="";if(e=$(a).find("form").serializeObject(),e.method||(i+="请选择抢位方式</br>"),e.platform||(i+="请选择抢位平台</br>"),("-3"==e.rank_end||-3==e.rank_start||Number(e.rank_end)<Number(e.rank_start))&&(i+="请正确选择期望排名,后面排名大于或等于前面排名</br>"),(!e.limit||isNaN(e.limit)||Number(e.limit)<.05||Number(e.limit)>99.99)&&(i+="请正确填写最高限价,限价必须是0.05到99.99的数字</br>"),e.nearly_success||(i+="请选择抢位不成功出价设置"),""!=i)return $.alert({title:"错误",closeBtn:!1,body:i,okBtn:"确定",height:"60px",backdrop:"static",keyboard:!1}),!1;if("auto"==e.method){var s,d;return s=f(Number($("#rob_rank").find(".slider input").val().split(";")[0])),d=f(Number($("#rob_rank").find(".slider input").val().split(";")[1])),t.ajax("auto_rob_rank",{keyword_id:n.keywordId,exp_rank_start:e.rank_start,exp_rank_end:e.rank_end,limit_price:parseInt(100*e.limit+.5),platform:e.platform,start_time:s,end_time:d,nearly_success:e.nearly_success},function(e){if(""!=e.limitError){var n,t;"version_limit"==e.limitError&&(n="Sorry!当前版本不支持",t='亲，您订购的版本不支持自动抢排名哦，请升级到八引擎版吧！&emsp;&emsp;<a href="/web/upgrade_suggest/" target="_blank">立即升级</a></div></div>'),"nums_limit"==e.limitError&&(n="Sorry，自动抢排名关键词个数已达上限",t="亲，自动抢位的关键词已达到50个上限！"),"others"==e.limitError&&(n="Sorry，自动抢排名失败",t="亲，请刷新页面重试"),$.alert({title:n,closeBtn:!1,body:t,okBtn:"知道了",height:"60px",backdrop:"static",keyboard:!1})}else r=!0,$(a).modal("hide")}),!1}r=!0,$(a).modal("hide")}),$(a).on("click",".rob_cancle",function(){var e=$("#"+n.keywordId);$.confirm({title:"提示",closeBtn:!1,body:"您确定取消“"+n.word+"”的自动抢排名吗？",okBtn:"确定",cancelBtn:"取消",height:"60px",backdrop:"static",keyboard:!1,okHide:function(){t.ajax("rob_cancle",{keyword_id:n.keywordId},function(){"rank"==n.target?e.trigger("delete_row",[n.keywordId]):e.trigger("update.rob_rank",["nomal"]),r=!1,$(a).modal("hide")})}})})},_=function(e,n){if(r){var a=e.find("form").serializeObject(),t=$("#"+n.keywordId);n.rank_start_name=e.find("#rank_start").next(".rank_name").html(),n.rank_end_name=e.find("#rank_end").next(".rank_name").html(),i.show($.extend({},n,a)),"auto"==a.method&&("rank"==n.target?(t.find(".platform_name").text("pc"==a.platform?"计算机":"移动　"),t.find(".exp_rank_start").text(d[a.rank_start]),t.find(".exp_rank_end").text(d[a.rank_end]),t.find(".limit_price").text(Number(a.limit).toFixed(2))):t.trigger("update.rob_rank",["auto",a.platform])),$("#keyword_table").data("saveOptions.rank",$.extend({},n,a))}r=!1,$(e).remove()},f=function(e){var n=Math.floor(e/60),a=e-60*n;return(10>n?"0"+n:n)+":"+(0==a?"00":a)},k=function(e){return 60*Number(e.split(":")[0])+Number(e.split(":")[1])};return{show:m}});