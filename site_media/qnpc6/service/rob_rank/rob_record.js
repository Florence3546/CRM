define("site_media/service/rob_rank/rob_record",["site_media/plugins/artTemplate/template","site_media/widget/ajax/ajax","site_media/plugins/moment/moment.min","site_media/plugins/highcharts/highcharts"],function(t,e,i){"use strict";var a,a='<div id="rob_record"  style="width: 600px; margin-left: -300px; left:50%;" tabindex="-1" role="dialog" data-hasfoot="false" class="sui-modal hide fade drawer">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" data-dismiss="modal" aria-hidden="true" class="sui-close">×</button>\n                <h4 class="modal-title">抢排名记录</h4>\n                <div class="btn-group show_model mr10">\n                    <a class="btn btn-sm active" data-type="char_info"><i class="iconfont b">&#xe60d;</i></a>\n                    <a class="btn btn-sm" data-type="table_info"><i class="iconfont b">&#xe60e;</i></a>\n                </div>                       \n            </div>\n            <div class="modal-body" style=" max-height: 400px; overflow-y: scroll">\n                <div class="drawer_body">\n                    <div style="text-align:right;margin-top:10px;">\n                        <div class="show_model">\n                            <a class="active" data-type="sign_char"><i class="iconfont b">&#xe60d;</i></a>\n                            <a data-type="sign_table"><i class="iconfont b">&#xe60e;</i></a>\n                        </div>\n                    </div>\n                    <div id="sign_char" style="height:280px;"></div>\n                    <div id="sign_table" class="hide" style="height:260px;overflow-y: scroll;margin:10px;">\n                        <table class="sui-table table-bordered">\n                            <thead>\n                                <tr>\n                                    <th>优化时间</th>\n                                    <th>出价</th>\n                                    <th>排名情况</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                <tr>\n                                    <td colspan="3" class="tc">\n                                        正在获取，请稍后。。。\n                                    </td>\n                                </tr>\n                            </tbody>\n                        </table>\n                    </div>\n                    <div style="padding:0 10px;">\n                        <span>当前设置：<span class="setting">--</span></span>\n                        <button class="sui-btn btn-xlarge btn-primary fr close_drawer" type="button">返回</button>\n                    </div>\n                </div>\n                <div id="char_info" style="height:340px;"></div>\n                <div id="table_info" class="hide">\n                    <table class="sui-table table-bordered">\n                        <thead>\n                            <tr>\n                                <th>优化时间</th>\n                                <th>出价</th>\n                                <th>排名情况</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            <tr>\n                                <td colspan="3" class="tc">\n                                    正在获取，请稍后。。。\n                                </td>\n                            </tr>\n                        </tbody>\n                    </table>                    \n                </div>                \n            </div>\n        </div>\n    </div>\n</div>\n',n=function(i){var n,d;n=t.compile(a)(i),d=$(n),$("body").append(d),d.modal({backdrop:"static"}),d.on("shown.bs.modal",function(){e.ajax("rob_record",{keyword_id:i.keywordId},function(t){s(t,i)})}),d.on("hidden.bs.modal",function(){$(this).remove()}),d.find(".show_model .btn").on("click",function(){var t=$(this).data().type;d.find(".show_model .btn").removeClass("active"),$(this).addClass("active"),$("#char_info,#table_info").addClass("hide"),$("#"+t).removeClass("hide")}),d.find(".close_drawer").on("click",function(){d.find(".drawer_body").removeClass("active")})},s=function(t,e){var a=[],n=[],s=[];if(t.data[e.keywordId].length)for(var d in t.data[e.keywordId].reverse()){var r=$.evalJSON(t.data[e.keywordId][d]);n.push(r),"ok"!=r.result_flag&&"nearly_ok"!=r.result_flag?"done"!=r.result_flag&&"failed"!=r.result_flag?s.push("<tr><td>"+r.rob_time+"</td><td>"+Number(r.price).toFixed(2)+"</td><td>"+r.msg+"</td></tr>"):(a.push({flag:"fail",time:r.rob_time,price:r.price,data:n,platform:r.platform,limit_price:r.limit_price,exp_rank_range:r.exp_rank_range,nearly_success:r.nearly_success,msg:n.length>1?n.reverse()[1].msg:n[0].msg}),n=[],s.push("<tr><td>"+r.rob_time+"</td><td>"+Number(r.price).toFixed(2)+'</td><td><img src="/site_media/qnpc6/static/images/fail.png?t=1484904941079"/>'+r.msg+"</td></tr>")):(a.push({flag:"ok",time:r.rob_time,price:r.price,data:n,msg:r.msg,platform:r.platform,limit_price:r.limit_price,exp_rank_range:r.exp_rank_range,nearly_success:r.nearly_success}),n=[],s.push("<tr><td>"+r.rob_time+"</td><td>"+Number(r.price).toFixed(2)+'</td><td><img src="/site_media/qnpc6/static/images/success.png?t=1484904941079"/>'+r.msg+"</td></tr>"))}$("#char_info").highcharts({chart:{type:"spline"},title:{text:""},subtitle:{text:""},credits:{text:""},legend:{enabled:!1},xAxis:{categories:a.slice(-18).map(function(t){return i(t.time).format("MM-D H:mm")})},yAxis:[{title:{text:"出价(元)"},min:0,gridLineColor:"#ddd",gridLineDashStyle:"Dash",gridLineWidth:1}],plotOptions:{spline:{marker:{radius:4,lineColor:"#666666",lineWidth:1}}},series:[{cursor:"pointer",name:"出价",lineColor:"#76a0c6",data:a.slice(-18).map(function(t){var e;return e="ok"==t.flag?"/site_media/qnpc6/static/images/success.png?t=1484904941079":"/site_media/qnpc6/static/images/fail.png?t=1484904941079",{y:t.price,events:{click:function(){return!1}},marker:{symbol:"url("+e+")",width:20,height:20},data:t}})}],tooltip:{formatter:function(){var t=this.point.data;return"当前出价:"+this.y.toFixed(2)+"元<br/>平台:"+("yd"==t.platform?"移动":"PC")+"   限价:"+t.limit_price+"元<br/>期望排名:"+t.exp_rank_range[0]+"~"+t.exp_rank_range[1]+"<br/>"+t.msg}}}),$("#table_info").find("tbody").html(s.reverse().join())};return{show:n}});